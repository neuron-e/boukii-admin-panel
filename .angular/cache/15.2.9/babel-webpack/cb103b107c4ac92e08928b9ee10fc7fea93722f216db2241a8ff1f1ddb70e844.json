{"ast":null,"code":"import _asyncToGenerator from \"D:/Projects/el-sotano-backoffice/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";\nimport { signInWithEmailAndPassword, signOut, onAuthStateChanged, getAuth } from '@angular/fire/auth';\nimport { createUserWithEmailAndPassword } from '@angular/fire/auth';\nimport { collection, query, where, getDocs } from 'firebase/firestore';\nimport { getFirestore } from '@angular/fire/firestore';\nimport * as i0 from \"@angular/core\";\nimport * as i1 from \"@angular/fire/auth\";\nimport * as i2 from \"@angular/router\";\nimport * as i3 from \"./userService\";\nexport class AuthService {\n  constructor(auth, router, userService) {\n    this.auth = auth;\n    this.router = router;\n    this.userService = userService;\n    this.user = null;\n    const user = JSON.parse(localStorage.getItem('sotanoUser'));\n    if (user) {\n      this.user = user;\n    }\n    onAuthStateChanged(auth, user => {\n      if (user) {\n        this.user = user;\n        localStorage.setItem('sotanoUser', JSON.stringify(user));\n      } else {\n        this.user = null;\n        localStorage.removeItem('sotanoUser');\n      }\n    });\n  }\n  login(email, password) {\n    var _this = this;\n    return _asyncToGenerator(function* () {\n      try {\n        const auth = getAuth();\n        const userCredential = yield signInWithEmailAndPassword(auth, email, password);\n        if (userCredential.user) {\n          localStorage.setItem('sotanoUser', JSON.stringify(userCredential.user));\n          _this.router.navigate(['/menu']);\n        }\n      } catch (error) {\n        console.error('Error during login:', error);\n      }\n    })();\n  }\n  register(email, password) {\n    var _this2 = this;\n    return _asyncToGenerator(function* () {\n      try {\n        const auth = getAuth();\n        yield createUserWithEmailAndPassword(auth, email, password);\n        _this2.router.navigate(['/menu']);\n      } catch (error) {\n        console.error('Error during registration:', error);\n      }\n    })();\n  }\n  logout() {\n    var _this3 = this;\n    return _asyncToGenerator(function* () {\n      yield signOut(_this3.auth);\n      _this3.user = null;\n      localStorage.removeItem('sotanoUser');\n    })();\n  }\n  isLoggedIn() {\n    return this.user !== null;\n  }\n  getUserByEmail(email) {\n    return _asyncToGenerator(function* () {\n      const db = getFirestore();\n      const usersRef = collection(db, 'usuarios');\n      const q = query(usersRef, where('email', '==', email));\n      const querySnapshot = yield getDocs(q);\n      let user;\n      querySnapshot.forEach(doc => {\n        // doc.data() is never undefined for query doc snapshots\n        console.log(doc.id, \" => \", doc.data());\n        user = doc.data();\n      });\n      return user;\n    })();\n  }\n}\nAuthService.ɵfac = function AuthService_Factory(t) {\n  return new (t || AuthService)(i0.ɵɵinject(i1.Auth), i0.ɵɵinject(i2.Router), i0.ɵɵinject(i3.UserService));\n};\nAuthService.ɵprov = /*@__PURE__*/i0.ɵɵdefineInjectable({\n  token: AuthService,\n  factory: AuthService.ɵfac,\n  providedIn: 'root'\n});","map":{"version":3,"mappings":"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","names":["signInWithEmailAndPassword","signOut","onAuthStateChanged","getAuth","createUserWithEmailAndPassword","collection","query","where","getDocs","getFirestore","AuthService","constructor","auth","router","userService","user","JSON","parse","localStorage","getItem","setItem","stringify","removeItem","login","email","password","userCredential","navigate","error","console","register","logout","isLoggedIn","getUserByEmail","db","usersRef","q","querySnapshot","forEach","doc","log","id","data","factory","providedIn"],"sourceRoot":"","sources":["D:\\Projects\\el-sotano-backoffice\\src\\service\\auth.service.ts"],"sourcesContent":["import { Injectable } from '@angular/core';\r\nimport { Auth, signInWithEmailAndPassword, signOut, onAuthStateChanged, getAuth } from '@angular/fire/auth';\r\nimport { Router } from '@angular/router';\r\nimport { User } from '@firebase/auth';\r\nimport { createUserWithEmailAndPassword } from '@angular/fire/auth';\r\nimport { UserService } from './userService';\r\nimport { collection, query, where, getDocs } from 'firebase/firestore';\r\nimport { getFirestore } from '@angular/fire/firestore';\r\n\r\n@Injectable({\r\n  providedIn: 'root'\r\n})\r\nexport class AuthService {\r\n  user: User | null = null;\r\n\r\n  constructor(private auth: Auth,private router: Router, private userService: UserService) {\r\n    const user = JSON.parse(localStorage.getItem('sotanoUser'));\r\n    if (user) {\r\n      this.user = user;\r\n    }\r\n    onAuthStateChanged(auth, (user) => {\r\n      if (user) {\r\n        this.user = user;\r\n        localStorage.setItem('sotanoUser', JSON.stringify(user));\r\n      } else {\r\n        this.user = null;\r\n        localStorage.removeItem('sotanoUser');\r\n      }\r\n    });\r\n  }\r\n\r\n  async login(email: string, password: string) {\r\n    try {\r\n      const auth = getAuth();\r\n      const userCredential = await signInWithEmailAndPassword(auth, email, password);\r\n      if (userCredential.user) {\r\n        localStorage.setItem('sotanoUser', JSON.stringify(userCredential.user));\r\n        this.router.navigate(['/menu']);\r\n      }\r\n    } catch (error) {\r\n      console.error('Error during login:', error);\r\n    }\r\n  }\r\n\r\n  async register(email: string, password: string): Promise<void> {\r\n    try {\r\n      const auth = getAuth();\r\n      await createUserWithEmailAndPassword(auth, email, password);\r\n      this.router.navigate(['/menu']);\r\n    } catch (error) {\r\n      console.error('Error during registration:', error);\r\n    }\r\n  }\r\n\r\n  async logout() {\r\n    await signOut(this.auth);\r\n    this.user = null;\r\n    localStorage.removeItem('sotanoUser');\r\n  }\r\n\r\n  isLoggedIn() {\r\n    return this.user !== null;\r\n  }\r\n\r\n  async getUserByEmail(email: string) {\r\n    const db = getFirestore();\r\n    const usersRef = collection(db, 'usuarios');\r\n    const q = query(usersRef, where('email', '==', email));\r\n    const querySnapshot = await getDocs(q);\r\n\r\n    let user;\r\n\r\n    querySnapshot.forEach((doc) => {\r\n      // doc.data() is never undefined for query doc snapshots\r\n      console.log(doc.id, \" => \", doc.data());\r\n      user = doc.data();\r\n    });\r\n\r\n    return user;\r\n  }\r\n}\r\n"]},"metadata":{},"sourceType":"module","externalDependencies":[]}