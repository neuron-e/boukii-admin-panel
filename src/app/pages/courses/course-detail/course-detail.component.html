<vex-secondary-toolbar current="Courses">
  <vex-breadcrumbs
    [crumbs]="['Detail Course', 'Detail course']"
    class="flex-auto"
  ></vex-breadcrumbs>
  <button class="ml-2" color="primary" mat-icon-button type="button">
    <mat-icon svgIcon="mat:more_vert"></mat-icon>
  </button>
</vex-secondary-toolbar>
<div [@stagger]="true"class="p-gutter container"style="max-width: none" *ngIf="!loading">
  <div class="flex flex-col sm:flex-row gap-4" style="width: 100%;float:left;padding: 2%">
    <div @fadeInUp class="card flex-auto">
      <mat-tab-group>
        <mat-tab label="Cours">
          <mat-card style="padding: 3% 5% 0 5%;">
            <mat-card-header style="display:block">
              <div style="float: left; width: 100%;">
                <div style="float: left;width: 50%;">
                  <div style="float: left; margin-right: 2%">
                    <img [src]="defaults.course_type === 1 ? imagePath : imagePathPrivate" width="100" height="100">
                  </div>
                  <div style="float: left; width: 75%;">
                    <p><strong>Classes de ski / Samedis Jeunesse / dès 5ans</strong></p>
                    <p>Colectif Ski</p>
                    <p>Les Pacots</p>
                  </div>

                  <div style="float: right;" style="float: right;cursor:pointer" (click)="goTo('/courses/update/'+this.id)">
                    <i class="fa fa-edit" style="color: #ff3085;font-size: 30px;"></i>
                  </div>
                </div>
                <div style="float: left;width: 50%;">
                  <div style="float:right;width: 100%">

                    <div style="float: right;margin: 0 0 0 25px;">
                      <mat-slide-toggle [checked]="true">
                        Options
                      </mat-slide-toggle>
                    </div>
                    <div style="float: right;margin: 0;">
                      <mat-slide-toggle [checked]="true">
                        Online
                      </mat-slide-toggle>
                    </div>
                    <div style="float: right;margin: 0 25px 0 0;">
                      <mat-slide-toggle [checked]="true">
                        Status
                      </mat-slide-toggle>
                    </div>
                  </div>
                </div>
              </div>

            </mat-card-header>
            <mat-card-content>

              <div style="float: left; width: 47%;margin: 2% 3% 0 0;">
                <img [src]="defaults.image">
                <ul style="margin: 2% 0 0 0;">
                  <li style="margin: 0 0 2% 0"><strong>Dates</strong></li>
                  <li *ngFor="let item of defaults.course_dates">{{parseDateToDay(item.date, 'YYYY-MM-DD', 'dddd')}}, {{parseDateToDay(item.date, 'YYYY-MM-DD', 'LL')}} <i style="text-align: right;float:right">{{parseDateToDay(item.hour_start, 'HH:mm:ss', 'HH:mm')}}h - {{parseDateToDay(item.hour_end, 'HH:mm:ss', 'HH:mm')}}h</i></li>
                </ul>
              </div>
              <div style="width:50%; margin-top:2%;float:left">
                <div style="width: 100%;">
                  <p style="float: left;width: 80%;text-align: left;"><b>Résumé</b></p>
                  <p style="float: left;width: 20%;text-align: right;"><b>Precio</b></p>
                </div>
                <div style="width: 100%;">
                  <p style="float: left;width: 50%;text-align: left;">
                    Neque porro quisquam est qui dolorem ipsum quia dolor sit amet, consectetur, adipisci velit
                  </p>
                  <p style="float: left;width: 50%;text-align: right;color:#ff3085"><b>180</b> CHF</p>
                </div>
              </div>
              <div style="width:50%; margin-top:2%;float:left">
                <div style="width: 100%;">
                  <p style="float: left;width: 80%;text-align: left;"><b>Description</b></p>
                  <p style="float: left;width: 20%;text-align: right;"><b>Edad</b></p>
                </div>
                <div style="width: 100%;">
                  <p style="float: left;width: 50%;text-align: left;">
                    Neque porro quisquam est qui dolorem ipsum quia dolor sit amet, consectetur, adipisci velit
                  </p>
                  <p style="float: left;width: 50%;text-align: right;">De 5 a 18 años</p>
                </div>
              </div>

              <div style="width:50%; margin-top:2%;float:left">
                <div class="flex flex-col sm:flex-row gap-2 sm:gap-6">

                  <div class="flex-auto">

                    <label for="dateFrom">DATE RÉSERVABLE À PARTIR DE</label>
                    <mat-form-field style="width: 100%">

                      <input matInput id="dateFrom" [(ngModel)]="defaults.date_start_res" [readonly]="true">
                    </mat-form-field>
                  </div>
                  <div class="flex-auto">

                    <label for="dateTo">DATE RÉSERVABLE JUSQU'À</label>
                    <mat-form-field style="width: 100%">

                      <input matInput id="dateTo" [(ngModel)]="defaults.date_end_res" [readonly]="true">
                    </mat-form-field>
                  </div>
                </div>

                <div class="flex flex-col sm:flex-row gap-2 sm:gap-6">
                  <div class="flex-auto" style="width: 50%; float:left">
                    <label for="duration">DURÉE</label>
                    <mat-form-field style="width: 100%">

                      <input id="duration" matInput required type="text" placeholder="DURÉE" [value]="defaults.duration ? defaults.duration : 'FLEXIBLE'" [readonly]="true">
                    </mat-form-field>
                  </div>
                  <div class="flex-auto" style="width: 50%; float:left">
                    <label for="participants">PARTICIPANTS MÁX</label>

                    <mat-form-field style="width: 100%">
                      <mat-label>PARTICIPANTS MÁX.</mat-label>
                      <input id="participants" matInput required type="number" [value]="defaults.max_participants" [(ngModel)]="defaults.max_participants" [readonly]="true">
                    </mat-form-field>
                  </div>
                </div>
              </div>
            </mat-card-content>
          </mat-card>
        </mat-tab>
        <mat-tab label="Niveaux">

          <mat-card style="padding: 0 3%;">
            <mat-card-header style="display:block">
              <div style="width: 100%;float:left;">
                <mat-card-title style="float: left;width: 35%;">Detalles curso</mat-card-title>
                <div style="float:right;width: 65%">
                  <div style="float: right;margin: 0 0 0 25px;">
                    <mat-slide-toggle [checked]="true">
                      Options
                    </mat-slide-toggle>
                  </div>
                  <div style="float: right;margin: 0;">
                    <mat-slide-toggle [checked]="true">
                      Online
                    </mat-slide-toggle>
                  </div>
                  <div style="float: right;margin: 0 25px 0 0;">
                    <mat-slide-toggle [checked]="true">
                      Status
                    </mat-slide-toggle>
                  </div>
                </div>
              </div>
              <mat-divider style="float: left;width: 100%;margin: 2% 0 0 0;"></mat-divider>
            </mat-card-header>
            <mat-card-content style="margin-top: 5%;">

              <div class="flex flex-col sm:flex-row gap-4" style="width: 100%;float:left;">
                <div @fadeInUp class="card flex-auto">
                  <mat-card style="padding: 0 3%;">
                    <mat-card-content style="margin-top: 5%;">

                      <div style="width: 100%;float:left;">
                        <ng-container *ngFor="let colorKey of colorKeys">
                          <div style="float: left; width: 100%;margin-top:3%" *ngFor="let groupLevel of groupedByColor[colorKey]; let groupIndex = index">
                            <div style="float: left;width: 10%;border-radius: 11%;height: 100px;padding: 2%;color: #fff;text-align: center;">
                              <mat-slide-toggle (change)="activeGroup($event, groupLevel)" [checked]="groupLevel.active"></mat-slide-toggle>
                            </div>
                            <div style="float: left;width: 16%;">
                              <div style="width:100%;text-align: center;border-radius: 0;height: 100px;padding: 2%;color: #fff;" [style.background-color]="colorKey">
                                {{groupLevel.annotation}} - {{groupLevel.name}}
                              </div>
                              <mat-form-field class="flex-auto" style="width: 100%; margin-top: 10%;" *ngIf="groupLevel.active">
                                <mat-select placeholder="Nivel minimo del profesor" (selectionChange)="setLevelTeacher($event, groupLevel)" [value]="calculateMonitorLevel(groupLevel)">
                                  <mat-option *ngFor="let item of levels" [value]="item">
                                    {{ item.league }} - {{ item.name }}
                                  </mat-option>
                                </mat-select>
                              </mat-form-field>
                            </div>
                            <div  style="float: left;width: 16%;margin: 0 0 0 2%;" *ngIf="groupLevel.active">
                              <div style="width:100%;border-radius: 0;height: 100px;padding: 2%;color: #000;background: #e6e6e6;text-align: center;" >
                                Grupos 2g
                              </div>
                              <div style="width: 100%; margin-top: 10%;height: 60px">
                                <button mat-button color="accent" style="width: 100%;border-radius: 5px;color:#fff;background: #ff3085;height: 100%" (click)="addSubGroup(groupLevel)">Añadir subgrupo</button>
                              </div>
                            </div>

                            <div  style="float: left;width: 16%;margin: 0 0 0 2%;" *ngIf="groupLevel.active">
                              <div style="width:100%;border-radius: 0;height: 100px;padding: 2%;color: #000;background: #e6e6e6;text-align: center;" >
                                Edad
                              </div>
                              <form [formGroup]="rangeForm" novalidate>
                                <mat-form-field class="flex-auto" style="width: 100%; margin-top: 10%">
                                  <input type="number" placeholder="Edad Minima" aria-label="Number" matInput (blur)="setMinAge($event, groupLevel)"
                                  [value]="calculateAgeMin(groupLevel)"/>
                                  <mat-error *ngIf="minAge.errors?.['min']">
                                    La edad mínima debe ser al menos 3.
                                  </mat-error>
                                  <mat-error *ngIf="minAge.errors?.['required']">
                                    Este campo es obligatorio.
                                  </mat-error>
                                </mat-form-field>
                                <mat-form-field class="flex-auto" style="width: 100%; margin-top: 10%">
                                  <input type="number" placeholder="Edad Máxima" aria-label="Number" matInput (blur)="setMaxAge($event, groupLevel)"
                                  [value]="calculateAgeMax(groupLevel)"/>
                                  <mat-error *ngIf="maxAge.errors?.['ageRange']">
                                    La edad máxima debe ser mayor que la edad mínima y menor o igual a 80.
                                  </mat-error>
                                  <mat-error *ngIf="maxAge.errors?.['max']">
                                    La edad máxima no debe ser mayor a 80.
                                  </mat-error>
                                  <mat-error *ngIf="maxAge.errors?.['required']">
                                    Este campo es obligatorio.
                                  </mat-error>
                                </mat-form-field>
                              </form>
                            </div>
                            <div  style="float: left;width: 16%;margin: 0 0 0 2%;" *ngIf="groupLevel.active">
                              <div style="width:100%;border-radius: 0%;height: 100px;padding: 2%;color: #000;background: #e6e6e6;text-align: center;" >
                                Alumnos <strong>0/{{defaults.max_participants}}</strong>
                              </div>
                              <mat-form-field class="flex-auto" style="width: 100%; margin-top: 10%">
                                <input type="number" placeholder="Max per Group" aria-label="Number" matInput (blur)="setSubGroupPax($event, groupLevel)" [value]="calculateSubGroupPaxes(groupLevel)"/>

                              </mat-form-field>
                            </div>

                            <ng-container *ngIf="groupLevel.active">

                              <div style="width:100%;float:left;overflow: scroll;" *ngFor="let subGroup of readSubGroups(groupLevel.id); let subGroupIndex = index">
                                <div style="float:left; width: 100%; margin-top: 5%;padding: 0 0% 0 10%">
                                  <div>
                                    <ul style="display: flex">
                                      <li style="float: left; width: 20%;font-size: 18px">
                                        <span [style.color]="colorKey"><strong>{{groupLevel.annotation}}</strong> - {{groupLevel.name}} - {{ subGroupIndex + 1 }}</span>
                                      </li>
                                      <li *ngFor="let dayLevel of daysDatesLevels; let dayIndex = index;"
                                          (click)="selectItem(dayLevel, dayIndex, subGroupIndex)"
                                          [style.color]="selectedItem === dayLevel.dateString && dayIndex === daySelectedIndex && subGroupIndex === subGroupSelectedIndex ? '#FF3085' : ''"
                                          style="float: left; width: 13%; text-align: center; cursor: pointer;">
                                        {{ dayLevel.dateString }}
                                      </li>

                                    </ul>
                                  </div>
                                </div>
                                <div style="float:left; width: 100%; margin-top: 5%;padding: 0 0% 0 10%" *ngIf="subGroupSelectedIndex !== null">
                                  <div>
                                    <ul>
                                      <li style="float: left; width: 20%;" (click)="subGroupSelectedIndex = subGroupIndex;">
                                        <mat-form-field class="flex-auto">
                                          <mat-label>Moniteur</mat-label>
                                          <input type="text" placeholder="Pick one" matInput [matAutocomplete]="autoMoniteur" [value]="getMonitorValue(groupLevel, subGroupIndex, daySelectedIndex)"/>
                                          <mat-autocomplete #autoMoniteur="matAutocomplete" [displayWith]="displayFnMoniteurs" >
                                            <mat-option *ngFor="let monitor of filteredMonitors | async"
                                              (onSelectionChange)="setSubGroupMonitor($event, monitor, groupLevel, subGroupSelectedIndex, daySelectedIndex)">
                                              {{monitor.first_name}} {{monitor.last_name}}
                                            </mat-option>
                                          </mat-autocomplete>
                                          <mat-icon matPrefix svgIcon="mat:person"></mat-icon>
                                        </mat-form-field>
                                      </li>
                                      <li style="float: left; width: 13%;" *ngFor="let item of daysDatesLevels">
                                        <div style="background-color: #CEE741;width: 25px;border-radius: 100%;height: 25px;margin: 0 auto;"></div>
                                      </li>
                                    </ul>
                                  </div>
                                </div>
                                <mat-divider class="text-border" style="float: left;width: 100%;border: 4px solid #f0f0f0;"></mat-divider>

                                <!-- n iteraciones por alumno-->
                                <div style="float:left; width: 100%; margin: 5% 0 5% 0;padding: 0 0 0 10%" *ngIf="false">
                                  <div>
                                    <ul>
                                      <li style="float: left; width: 20%;">
                                        <div style="float: left; width: 100%;">
                                          <div style="float: left; width: 15%;margin: 5% 5% 0 0;">
                                            <img [src]="userAvatar" width="50" height="50">
                                          </div>
                                          <div style="float: left; width: 80%;">
                                            <p style="font-size: 16px;">Maternini Mirko (+3)</p>
                                            <p style="font-size: 10px;">FR · Switzerland · 43 ans</p>
                                          </div>
                                        </div>
                                      </li>
                                      <li style="float: left; width: 13%;">
                                        <div style="background-color: #CEE741;width: 25px;border-radius: 100%;height: 25px;margin: 0 auto;"></div>
                                      </li>
                                      <li style="float: left; width: 13%;">
                                        <div style="background-color: #CEE741;width: 25px;border-radius: 100%;height: 25px;margin: 0 auto;"></div>
                                      </li>
                                      <li style="float: left; width: 13%;">
                                        <div style="background-color: #CEE741;width: 25px;border-radius: 100%;height: 25px;margin: 0 auto;"></div>
                                      </li>
                                      <li style="float: left; width: 13%;">
                                        <div style="background-color: #CEE741;width: 25px;border-radius: 100%;height: 25px;margin: 0 auto;"></div>
                                      </li>
                                      <li style="float: left; width: 13%;">
                                        <div style="background-color: #CEE741;width: 25px;border-radius: 100%;height: 25px;margin: 0 auto;"></div>
                                      </li>
                                      <li style="float: left; width: 13%;">
                                        <div style="background-color: #CEE741;width: 25px;border-radius: 100%;height: 25px;margin: 0 auto;"></div>
                                      </li>
                                    </ul>
                                  </div>
                                </div>
                              </div>

                            </ng-container>
                          </div>
                        </ng-container>
                      </div>
                    </mat-card-content>
                  </mat-card>
                </div>
              </div>
            </mat-card-content>
          </mat-card>
        </mat-tab>
        <mat-tab label="Reservations">

        </mat-tab>
        <mat-tab label="Statistiques">

        </mat-tab>

      </mat-tab-group>
    </div>


  </div>
</div>
