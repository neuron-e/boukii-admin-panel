<vex-secondary-toolbar current="Bonuses">
  <vex-breadcrumbs
    [crumbs]="['Bonuses', 'Nouvelle bonus']"
    class="flex-auto"
  ></vex-breadcrumbs>
  <button class="ml-2" color="primary" mat-icon-button type="button">
    <mat-icon svgIcon="mat:more_vert"></mat-icon>
  </button>
</vex-secondary-toolbar>
<div
  [@stagger]="true"
  class="p-gutter container"
  style="max-width: none"
  *ngIf="!loading"
>
  <div class="flex flex-col sm:flex-row gap-4">
    <div @fadeInUp class="card flex-auto">
      <div class="px-6 py-4 border-b flex items-center">
        <h2 class="title m-0">Nouvelle bonus</h2>
      </div>
      <div class="px-6 py-4 flex flex-col" [formGroup]="form">

        <div class="flex flex-col sm:flex-row gap-2 sm:gap-6">

          <mat-form-field class="flex-auto" style="width: 80%;" [ngStyle]="{'width': mode === 'create' ? '80%' : '100%'}">
            <mat-label>Code</mat-label>
            <input formControlName="code" [(ngModel)]="defaults.code" matInput required [readonly]="mode === 'update'">
          </mat-form-field>

          <div class="flex-auto" *ngIf="mode === 'create'" style="width: 20%;">
            <button mat-raised-button color="accent" style="color: #fff;background: #f53d7c;padding: 1%;width: 100%; border-radius: 0; margin: 3% 0 0 0;" (click)="generateRandomCode()">Generar código automaticamente</button>
          </div>
        </div>
        <mat-form-field class="flex-auto">
          <mat-label>Client</mat-label>
          <input
            type="text"
            placeholder="Pick one"
            aria-label="Number"
            matInput
            [formControl]="clientsForm"
            [matAutocomplete]="auto"
            [(ngModel)]="defaults.client_id"
          />
          <mat-autocomplete #auto="matAutocomplete" [displayWith]="displayFn">
            <mat-option
              *ngFor="let client of filteredOptions | async"
              [value]="client"
            >
              {{client.first_name}} {{client.last_name}}
            </mat-option>
          </mat-autocomplete>
          <mat-icon matPrefix svgIcon="mat:person"></mat-icon>
        </mat-form-field>

        <mat-form-field class="flex-auto" *ngIf="mode === 'create'">
          <mat-label>MONTANT</mat-label>
          <input formControlName="quantity" [(ngModel)]="defaults.quantity" matInput required>
        </mat-form-field>

        <div class="flex flex-col sm:flex-row gap-2 sm:gap-6" *ngIf="mode === 'update'">

          <mat-form-field class="flex-auto">
            <mat-label>MONTANT</mat-label>
            <input formControlName="quantity" [(ngModel)]="defaults.quantity" matInput required>
          </mat-form-field>

          <mat-form-field class="flex-auto">
            <mat-label>Solde restant?</mat-label>
            <input formControlName="budget" matInput [value]="defaults.remaining_balance" [(ngModel)]="defaults.remaining_balance" readonly="true">
          </mat-form-field>
        </div>

        <div class="flex-auto">
          <mat-label>Payé?</mat-label><br>
          <mat-slide-toggle
            color="accent"
            formControlName="payed" [(ngModel)]="defaults.payed">
          </mat-slide-toggle>
        </div>
        <div class="flex items-center justify-end gap-2">
          <button mat-button type="button" (click)="goTo('/bonuses')">Cancelar</button>
          <!-- Added (click) event here -->
          <button
            color="primary"
            mat-raised-button
            type="button"
            (click)="save()"
            [disabled]="form.invalid"
          >
            Guardar
          </button>
        </div>
      </div>

    </div>
  </div>
</div>
