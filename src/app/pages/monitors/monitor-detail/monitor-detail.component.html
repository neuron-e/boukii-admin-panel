<div class="container py-6" style="max-width: none;">
  <div class="card overflow-hidden">
    <div class="h-64 relative overflow-hidden">
      <img
        class="w-full h-full object-cover"
        src="../../../../assets/img/8.png" />
      <div
        class="absolute bg-black opacity-25 top-0 right-0 bottom-0 left-0 w-full h-full z-0"></div>

      <img
        class="avatar h-24 w-24 absolute top-6 ltr:left-4 rtl:right-4 sm:hidden"
        [src]="defaults.image" />
    </div>

    <div class="z-10 relative -mt-16 px-6 flex items-center" style="margin-top: -6rem !important;position: relative;bottom: 80px;" >
      <img
        @scaleIn
        class="avatar h-24 w-24 flex-none align-start hidden sm:block border-2 border-white"
        [src]="defaults.image" />

      <div class="max-w-full flex-auto sm:ltr:ml-6 sm:rtl:mr-6">
        <div class="h-16 items-end">
          <p @fadeInRight class="headline text-white" style="font-size: 12px;">FR · Switzerland · 43 ans</p>

          <h1 @fadeInRight class="headline text-white">{{ defaults.first_name}} {{ defaults.last_name }}</h1>

          <mat-icon svgIcon="mat:chat"></mat-icon>
          <mat-icon svgIcon="mat:mail_outline"></mat-icon>
          <mat-icon svgIcon="mat:contact_phone"></mat-icon>
        </div>

      </div>
    </div>
  </div>



<div class="mt-6 flex flex-col md:flex-row md:items-start" *ngIf="!loading">
  <mat-tab-group style="width: 100%">
    <mat-tab label="Profile">
      <mat-vertical-stepper #stepper="matHorizontalStepper" [linear]="false">

        <ng-template matStepperIcon="edit">
          <mat-icon svgIcon="mat:done_all"></mat-icon>
        </ng-template>

        <ng-template matStepperIcon="done">
          <mat-icon svgIcon="mat:done_all"></mat-icon>
        </ng-template>

        <mat-step [stepControl]="formInfoAccount">
          <form [formGroup]="formInfoAccount">
            <ng-template matStepLabel>Info de compte</ng-template>

            <div class="flex flex-col sm:flex-row gap-2 sm:gap-6">
              <div *ngIf="imagePreviewUrl" class="image-container">
                <img [src]="imagePreviewUrl" alt="Image Preview" width="400" height="290" style="width: 400px;height: 290px;object-fit: contain;">
              </div>

              <div class="input-container">

                <input type="file" formControlName="image" placeholder="Select an image" (change)="onFileChanged($event)" id="file"/>
                <label for="file" class="btn-1">upload file</label>
                <p>Maximum 2mb</p>
                <p>Formats supportés: PNG, JPG</p>
              </div>
            </div>

              <div class="flex flex-col sm:flex-row gap-2 sm:gap-6" style="margin: 3% 0 0 0;">
                <mat-form-field class="flex-auto">
                  <mat-label>Nom</mat-label>
                  <input formControlName="name" matInput required type="text" [(ngModel)]="defaults.first_name">

                </mat-form-field>

                <mat-form-field class="flex-auto">
                  <mat-label>Prenom</mat-label>
                  <input formControlName="surname" matInput required type="text" [(ngModel)]="defaults.last_name">
                </mat-form-field>
             </div>

              <div class="flex flex-col sm:flex-row gap-2 sm:gap-6">
                <mat-form-field class="flex-auto">
                  <mat-label>Email</mat-label>
                  <input formControlName="email" matInput required type="mail" [(ngModel)]="defaults.email">

                </mat-form-field>

                <mat-form-field class="flex-auto">
                  <mat-label>Nom d'utilisateur</mat-label>
                  <input formControlName="username" matInput required type="text" [(ngModel)]="defaultsUser.username">
                </mat-form-field>
              </div>


            <div class="flex flex-col sm:flex-row gap-2 sm:gap-6">
              <mat-form-field class="flex-auto">
                <mat-label>Password</mat-label>
                <input formControlName="password" matInput required type="password" [(ngModel)]="defaultsUser.password">

              </mat-form-field>

              <mat-form-field class="vex-flex-form-field flex-auto">
                <mat-label>Station</mat-label>

                <input type="text" placeholder="Selecciona una opción" matInput [formControl]="myControlStations" [matAutocomplete]="autoStation" formControlName="station">

                <mat-autocomplete #autoStation="matAutocomplete">
                  <mat-option *ngFor="let option of filteredStations | async" [value]="option.name" (onSelectionChange)="defaults.active_station = option.id">
                    {{option.name}}
                  </mat-option>
                </mat-autocomplete>
              </mat-form-field>
            </div>
            <div class="actions flex items-center justify-end gap-2">
              <button mat-button type="button" (click)="goTo('/monitors')">Cancelar</button>

              <button (click)="stepper.reset()" [disabled]="formInfoAccount.pristine" color="primary" mat-button type="button">Reset</button>
              <button [disabled]="formInfoAccount.invalid" color="primary" mat-raised-button matStepperNext>
                Next
              </button>
            </div>
          </form>
        </mat-step>
        <mat-step [stepControl]="formPersonalInfo">
          <form [formGroup]="formPersonalInfo">
            <ng-template matStepLabel>Données Personnelles</ng-template>

            <div class="flex flex-col sm:flex-row gap-2 sm:gap-6" style="margin: 3% 0 0 0;">

              <mat-form-field class="flex-auto">
                <input matInput [matDatepicker]="pickerFrom" placeholder="Date de naissance" formControlName="fromDate" [max]="minDate" [(ngModel)]="defaults.birth_date">
                <mat-datepicker-toggle matSuffix [for]="pickerFrom"></mat-datepicker-toggle>
                <mat-datepicker #pickerFrom [startAt]="minDate"></mat-datepicker>
              </mat-form-field>

            </div>

            <div class="flex flex-col sm:flex-row gap-2 sm:gap-6">
              <mat-form-field class="flex-auto">
                <mat-label>Teléphone</mat-label>

                <input formControlName="phone" matInput required type="tel" [(ngModel)]="defaults.telephone">
              </mat-form-field>

              <mat-form-field class="flex-auto">
                <mat-label>Portable</mat-label>
                <input formControlName="mobile" matInput required type="tel" [(ngModel)]="defaults.phone">

              </mat-form-field>
            </div>

            <div class="flex flex-col sm:flex-row gap-2 sm:gap-6">
              <mat-form-field class="flex-auto">
                <mat-label>Addresse</mat-label>

                <input formControlName="address" matInput required type="text" [(ngModel)]="defaults.address">
              </mat-form-field>

              <mat-form-field class="flex-auto">
                <mat-label>Code Postal</mat-label>
                <input formControlName="postalCode" matInput required type="text" [(ngModel)]="defaults.cp">

              </mat-form-field>
            </div>



            <div class="flex flex-col sm:flex-row gap-2 sm:gap-6">
              <mat-form-field class="vex-flex-form-field flex-auto">
                <mat-label>Pays</mat-label>
                <input type="text" placeholder="Selecciona una opción" matInput [formControl]="myControlCountries" [matAutocomplete]="autoCountry" formControlName="country">
                <mat-autocomplete #autoCountry="matAutocomplete" [displayWith]="displayFnCountry">
                  <mat-option *ngFor="let country of filteredCountries | async" [value]="country" (onSelectionChange)="defaults.country = country.id">
                    {{country.name}}
                  </mat-option>
                </mat-autocomplete>
              </mat-form-field>

              <mat-form-field class="vex-flex-form-field flex-auto">
                <mat-label>Canton</mat-label>
                <input type="text" placeholder="Selecciona una opción" matInput [formControl]="myControlProvinces" [matAutocomplete]="autoProvince" formControlName="province">
                <mat-autocomplete #autoProvince="matAutocomplete" [displayWith]="displayFnProvince">
                  <mat-option *ngFor="let province of filteredProvinces | async" [value]="province" (onSelectionChange)="defaults.province = province.id">
                    {{province.name}}
                  </mat-option>
                </mat-autocomplete>
              </mat-form-field>

              <mat-form-field class="flex-auto" appearance="fill">
                <mat-label>Idiomas</mat-label>
                <mat-select [formControl]="languagesControl" multiple>
                  <mat-select-trigger>
                    <div *ngIf="selectedLanguages.length > 0; else placeholderLangs">
                      {{ getSelectedLanguageNames() }}
                    </div>
                    <ng-template #placeholderLangs>Selecciona los idiomas</ng-template>
                  </mat-select-trigger>
                  <mat-option *ngFor="let language of filteredLanguages | async" [value]="language" (onSelectionChange)="toggleSelectionLanguages($event, language)">
                    {{language.name}}
                  </mat-option>
                </mat-select>
              </mat-form-field>
            </div>

            <div class="actions flex items-center justify-end gap-2">
              <button mat-button type="button" (click)="goTo('/monitors')">Cancelar</button>

              <button (click)="stepper.reset()" [disabled]="formPersonalInfo.pristine" color="primary" mat-button type="button">Reset</button>
              <button [disabled]="formPersonalInfo.invalid" color="primary" mat-raised-button matStepperNext>
                Next
              </button>
            </div>
          </form>
        </mat-step>

        <mat-step [stepControl]="formWorkInfo">
          <form [formGroup]="formWorkInfo">
            <ng-template matStepLabel>Information de travail</ng-template>

            <div class="flex flex-col sm:flex-row gap-2 sm:gap-6" style="margin: 3% 0 0 0;">
              <mat-form-field class="flex-auto">
                <mat-label>Nº AVS</mat-label>
                <input formControlName="avs" matInput required type="text" [(ngModel)]="defaults.avs">

              </mat-form-field>

              <mat-form-field class="flex-auto">
                <mat-label>Permis de travail</mat-label>
                <input formControlName="workId" matInput required type="text" [(ngModel)]="defaults.work_license">
              </mat-form-field>
            </div>

            <div class="flex flex-col sm:flex-row gap-2 sm:gap-6">
              <mat-form-field class="flex-auto">
                <mat-label>IBAN</mat-label>
                <input formControlName="iban" matInput required type="text" [(ngModel)]="defaults.bank_details">

              </mat-form-field>
            </div>

            <div class="flex flex-col sm:flex-row gap-2 sm:gap-6">
              <mat-form-field class="vex-flex-form-field flex-auto">
                <mat-label>Pays</mat-label>
                <input type="text" placeholder="Selecciona una opción" matInput [formControl]="myControlWorkCountries" [matAutocomplete]="autoCountryWork" formControlName="countryWork">
                <mat-autocomplete #autoCountryWork="matAutocomplete" [displayWith]="displayFnCountry">
                  <mat-option *ngFor="let country of filteredWorkCountries | async" [value]="country" (onSelectionChange)="defaults.world_country = country.id">
                    {{country.name}}
                  </mat-option>
                </mat-autocomplete>
              </mat-form-field>

              <mat-form-field class="flex-auto">
                <mat-label>Children</mat-label>
                <input formControlName="children" matInput required type="number" (input)="updateChildren($event)" [(ngModel)]="defaults.children">

              </mat-form-field>
            </div>
            <div class="flex flex-col sm:flex-row gap-2 sm:gap-6">

             <!-- Añadir niños con modal -->
              <mat-table #childrenTable [dataSource]="childrenData" *ngIf="formWorkInfo.value.children > 0">

                <!-- Otros contenedores según tu descripción -->

                <ng-container matColumnDef="name">
                  <mat-header-cell *matHeaderCellDef> Name </mat-header-cell>
                  <mat-cell *matCellDef="let element">
                    <mat-form-field class="flex-auto" style="margin: 2% 0 0 0;">
                      <mat-label>Name</mat-label>
                      <input matInput [(ngModel)]="element.name" formControlName="childName" type="text">
                    </mat-form-field>
                  </mat-cell>
                </ng-container>

                <ng-container matColumnDef="date">
                  <mat-header-cell *matHeaderCellDef>  Date de naissance </mat-header-cell>
                  <mat-cell *matCellDef="let element">
                    <mat-form-field class="flex-auto" style="margin: 2% 0 0 0;">
                      <input matInput [matDatepicker]="pickerFromChild" placeholder="Date de naissance" [(ngModel)]="element.date" [max]="minDateChild" formControlName="childAge">
                      <mat-datepicker-toggle matSuffix [for]="pickerFromChild"></mat-datepicker-toggle>
                      <mat-datepicker #pickerFromChild [startAt]="minDateChild"></mat-datepicker>
                    </mat-form-field>
                  </mat-cell>
                </ng-container>

                <!-- Ícono para eliminar
                <ng-container matColumnDef="delete">
                  <mat-header-cell *matHeaderCellDef> Eliminar </mat-header-cell>
                  <mat-cell *matCellDef="let element">
                    <mat-icon svgIcon="mat:delete" (click)="removeChild(element)"></mat-icon>
                  </mat-cell>
                </ng-container> -->

                <mat-header-row *matHeaderRowDef="displayedColumnsChildren"></mat-header-row>
                <mat-row *matRowDef="let row; columns: displayedColumnsChildren;"></mat-row>
              </mat-table>
            </div>

            <div class="flex flex-col sm:flex-row gap-2 sm:gap-6">
              <mat-form-field class="flex-auto" appearance="fill">
                <mat-label>Deportes</mat-label>
                <mat-select [formControl]="sportsControl" multiple>

                  <mat-select-trigger>
                    <div *ngIf="sportsControl.value?.length > 0; else placeholder">
                      {{ getSelectedSportsNames() }}
                    </div>
                    <ng-template #placeholder>Selecciona los deportes</ng-template>
                  </mat-select-trigger>

                  <mat-option *ngFor="let sport of filteredSports | async" [value]="sport" (onSelectionChange)="toggleSelection($event, sport)">
                    {{sport.name}}
                  </mat-option>
                </mat-select>
              </mat-form-field>
            </div>



            <div class="">


               <mat-table #sportsCurrentTable [dataSource]="sportsCurrentData">
                <caption style="width: 100px"> Current sports</caption>
                 <!-- Otros contenedores según tu descripción -->
                 <ng-container matColumnDef="delete">
                  <mat-header-cell *matHeaderCellDef class="delete-column">Eliminar</mat-header-cell>
                  <mat-cell *matCellDef="let element; let i = index" class="delete-column">
                    <mat-icon svgIcon="mat:delete" (click)="removeSport(i, element)"></mat-icon>
                  </mat-cell>
                </ng-container>
                 <ng-container matColumnDef="name">
                  <mat-header-cell *matHeaderCellDef> Name </mat-header-cell>
                  <mat-cell *matCellDef="let element">
                    <mat-form-field class="flex-auto" style="margin: 2% 0 0 0;">
                      <mat-label>Name</mat-label>
                      <input matInput [value]="element.name" type="text" [readonly]="true">
                    </mat-form-field>
                  </mat-cell>
                </ng-container>

                <ng-container matColumnDef="level">
                  <mat-header-cell *matHeaderCellDef>Niveaux</mat-header-cell>
                  <mat-cell *matCellDef="let element">
                    <mat-form-field class="flex-auto" style="margin: 2% 0 0 0;">
                     <mat-label>Niveaux</mat-label>
                     <input type="text" placeholder="Pick one" aria-label="Number" matInput [matAutocomplete]="autoLevel" [value]="element.level.name" [(ngModel)]="element.level"/>
                     <mat-autocomplete #autoLevel="matAutocomplete" [displayWith]="displayFnLevel">
                       <mat-option *ngFor="let level of element.degrees" [value]="level"  (onSelectionChange)="element.level = level" (onSelectionChange)="updateLevel(element, level)">
                         {{level.annotation}} - {{level.name}}
                       </mat-option>
                     </mat-autocomplete>
                    </mat-form-field>
                  </mat-cell>
                </ng-container>

                <ng-container matColumnDef="salary">
                  <mat-header-cell *matHeaderCellDef>Salary</mat-header-cell>
                  <mat-cell *matCellDef="let element">
                    <mat-form-field class="flex-auto" style="margin: 2% 0 0 0;">
                     <mat-label>Salary</mat-label>
                     <input type="text" placeholder="Pick one" aria-label="Number" matInput [value]="getSalary(element.salary_level)?.name" [matAutocomplete]="autoSalary"/>
                     <mat-autocomplete #autoSalary="matAutocomplete" [displayWith]="displayFnSalary">
                       <mat-option *ngFor="let salary of filteredSalary | async" [value]="salary" (onSelectionChange)="element.salary_id = salary.id" (onSelectionChange)="updateSalary(element, salary)">
                         {{salary.name}}
                       </mat-option>
                     </mat-autocomplete>
                    </mat-form-field>
                  </mat-cell>
                </ng-container>

                <ng-container matColumnDef="auth">
                  <mat-header-cell *matHeaderCellDef> Authorised Levels </mat-header-cell>
                  <mat-cell *matCellDef="let element">
                    <div style="width: 100%; float:left">
                      <div *ngFor="let item of element.degrees" class="chip-level" [style.border]="'2px solid ' + item.color"
                      [ngStyle]="{
                        'background': checkMonitorAuth(element, item) ? item.color : '#fff'
                      }"
                        (click)="authoriseCurrentLevel(item, element)">
                        <p style="color: #000;text-align: center"
                        [ngStyle]="{
                          'color': checkMonitorAuth(element, item) ? '#fff': '#000'
                        }"
                        >{{ item.annotation }}</p>
                      </div>
                     </div>
                  </mat-cell>
                </ng-container>

                 <mat-header-row *matHeaderRowDef="displayedCurrentColumns"></mat-header-row>
                 <mat-row *matRowDef="let row; columns: displayedCurrentColumns;"></mat-row>
               </mat-table>
             </div>

             <div class="flex flex-col sm:flex-row gap-2 sm:gap-6">

              <mat-table #sportsTable [dataSource]="sportsData" *ngIf="this.sportsData.data.length > 0">
                <caption style="width: 100px"> New sports</caption>

                <!-- Otros contenedores según tu descripción -->
                <ng-container matColumnDef="name">
                 <mat-header-cell *matHeaderCellDef> Name </mat-header-cell>
                 <mat-cell *matCellDef="let element">
                   <mat-form-field class="flex-auto" style="margin: 2% 0 0 0;">
                     <mat-label>Name</mat-label>
                     <input matInput [value]="element.name" type="text" [readonly]="true">
                   </mat-form-field>
                 </mat-cell>
               </ng-container>

               <ng-container matColumnDef="level">
                 <mat-header-cell *matHeaderCellDef>Niveaux</mat-header-cell>
                 <mat-cell *matCellDef="let element">
                   <mat-form-field class="flex-auto" style="margin: 2% 0 0 0;">
                    <mat-label>Niveaux</mat-label>
                    <input type="text" placeholder="Pick one" aria-label="Number" matInput [formControl]="levelForm" [matAutocomplete]="autoLevel" [(ngModel)]="element.level"/>
                    <mat-autocomplete #autoLevel="matAutocomplete" [displayWith]="displayFnLevel">
                      <mat-option *ngFor="let level of element.degrees" [value]="level">
                        {{level.annotation}} - {{level.name}}
                      </mat-option>
                    </mat-autocomplete>
                   </mat-form-field>
                 </mat-cell>
               </ng-container>

               <ng-container matColumnDef="salary">
                 <mat-header-cell *matHeaderCellDef>Salary</mat-header-cell>
                 <mat-cell *matCellDef="let element">
                   <mat-form-field class="flex-auto" style="margin: 2% 0 0 0;">
                    <mat-label>Salary</mat-label>
                    <input type="text" placeholder="Pick one" aria-label="Number" matInput [formControl]="salaryForm" [matAutocomplete]="autoSalary"/>
                    <mat-autocomplete #autoSalary="matAutocomplete" [displayWith]="displayFnSalary">
                      <mat-option *ngFor="let salary of filteredSalary | async" [value]="salary" (onSelectionChange)="element.salary_id = salary.id">
                        {{salary.name}}
                      </mat-option>
                    </mat-autocomplete>
                   </mat-form-field>
                 </mat-cell>
               </ng-container>

               <ng-container matColumnDef="auth">
                <mat-header-cell *matHeaderCellDef> Authorised Levels </mat-header-cell>
                <mat-cell *matCellDef="let element">
                  <div style="width: 100%; float:left">
                    <div *ngFor="let item of element.degrees" class="chip-level" [style.border]="'2px solid ' + item.color"
                    [ngStyle]="{
                      'background': isAuthorized(item) ? item.color : '#fff'
                    }"
                      (click)="authoriseLevel(item)">
                      <p style="color: #000;text-align: center"
                      [ngStyle]="{
                        'color': isAuthorized(item) ? '#fff': '#000'
                      }"
                      >{{ item.annotation }}</p>
                    </div>
                   </div>
                </mat-cell>
              </ng-container>
                <!-- Ícono para eliminar
                <ng-container matColumnDef="delete">
                  <mat-header-cell *matHeaderCellDef> Eliminar </mat-header-cell>
                  <mat-cell *matCellDef="let element">
                    <mat-icon svgIcon="mat:delete" (click)="removeChild(element)"></mat-icon>
                  </mat-cell>
                </ng-container> -->

                <mat-header-row *matHeaderRowDef="displayedColumns"></mat-header-row>
                <mat-row *matRowDef="let row; columns: displayedColumns;"></mat-row>
              </mat-table>


            </div>
            <div class="actions flex items-center justify-end gap-2">
              <button mat-button type="button" (click)="goTo('/monitors')">Cancelar</button>

              <button (click)="stepper.reset()" [disabled]="formPersonalInfo.pristine" color="primary" mat-button type="button">Reset</button>
              <button [disabled]="formPersonalInfo.invalid" color="primary" mat-raised-button matStepperNext>
                Next
              </button>
            </div>
          </form>
        </mat-step>

        <mat-step [stepControl]="formCivilStatusInfo">
          <form [formGroup]="formCivilStatusInfo">
            <ng-template matStepLabel>Etat civil</ng-template>

            <div class="flex flex-col sm:flex-row gap-2 sm:gap-6" style="margin: 3% 0 0 0;">
              <mat-form-field class="flex-auto">
                <mat-label>Estado Civil</mat-label>
                <input type="text" matInput [formControl]="myControlCivilStatus" formControlName="civilStatus" [matAutocomplete]="autoCivilStatus" [value]="defaults.civil_status" >
                <mat-autocomplete #autoCivilStatus="matAutocomplete">
                  <mat-option *ngFor="let civilStatus of filteredCivilStatus | async" [value]="civilStatus" (onSelectionChange)="defaults.civil_status = civilStatus">
                    {{ civilStatus }}
                  </mat-option>
                </mat-autocomplete>

              </mat-form-field>

              <mat-form-field class="flex-auto">
                <mat-label>Conjoint travaille?</mat-label>
                <mat-select formControlName="spouse" (selectionChange)="setValueSpouse($event)">
                  <mat-option value="y">Yes</mat-option>
                  <mat-option value="n">No</mat-option>
                </mat-select>
              </mat-form-field>

              <mat-form-field class="flex-auto">
                <mat-label>Demande d'allocation familiales?</mat-label>
                <mat-select formControlName="workMobility" (selectionChange)="setValueLocation($event)">
                  <mat-option value="y" >Yes</mat-option>
                  <mat-option value="n" >No</mat-option>
                </mat-select>
              </mat-form-field>
            </div>

            <div class="flex flex-col sm:flex-row gap-2 sm:gap-6" *ngIf="defaults.partner_works">
              <mat-form-field class="flex-auto">
                <mat-label>Permis travail du conjoint</mat-label>
                <input formControlName="spouseWorkId" matInput required type="text" [disabled]="!defaults.partner_works" [(ngModel)]="defaults.partner_work_license">

              </mat-form-field>
              <mat-form-field class="flex-auto">
                <mat-label>Pourcentage du conjoint (%)</mat-label>
                <input formControlName="spousePercentage" matInput required type="text" [disabled]="!defaults.partner_works" [(ngModel)]="defaults.partner_percentaje">

              </mat-form-field>
            </div>
            <div class="actions flex items-center justify-end gap-2">
              <button mat-button type="button" (click)="goTo('/monitors')">Cancelar</button>

              <button (click)="stepper.reset()" [disabled]="formPersonalInfo.pristine" color="primary" mat-button type="button">Reset</button>
              <button [disabled]="formPersonalInfo.invalid" color="primary" mat-raised-button matStepperNext (click)="save()">
                Save
              </button>
            </div>
          </form>
        </mat-step>
      </mat-vertical-stepper>
    </mat-tab>

    <mat-tab label="Cours">

    </mat-tab>
    <mat-tab label="Planning">

      <vex-monitor-calendar></vex-monitor-calendar>
    </mat-tab>
    <mat-tab label="Statistiques" *ngIf="false">

    </mat-tab>
  </mat-tab-group>
</div>

</div>
