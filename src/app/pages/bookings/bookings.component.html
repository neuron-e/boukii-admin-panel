<vex-page-layout>

  <vex-secondary-toolbar>
    <vex-breadcrumbs [crumbs]="['bookings', 'list']" class="flex-auto"></vex-breadcrumbs>

    <button class="ml-2" color="primary" mat-icon-button type="button">
      <mat-icon svgIcon="mat:more_vert"></mat-icon>
    </button>
  </vex-secondary-toolbar>
  <vex-page-layout-content class="-mt-6 fullwidth" [ngClass]="{'table-show-detail': this.showDetail}">
      <vex-aio-table [columns]="columns"  [entity]="entity" [deleteEntity]="deleteEntity" [title]="'bookings'" [route]="'bookings'" [createComponent]="createComponent" [canDelete]="false" [canDeactivate]="false"
      (showDetailEvent)="showDetailEvent($event)" [with]="'&with[]=bookingusers.course'" [filterColumn]="'school_id'" [filterField]="user.schools[0].id" [sectionIcon]="icon"
      [showDetail]="showDetail">
    </vex-aio-table>
  </vex-page-layout-content>
  <vex-page-layout-content class="-mt-6 fullwidth" style="width: 35%;float:left" *ngIf="showDetail">
    <mat-card style="padding: 0 3%;">
      <mat-card-header style="display:block">
        <div style="width: 100%;float: left;">
          <mat-icon style="float: right;cursor: pointer;" svgIcon="mat:close" (click)="showDetail = false"></mat-icon>
          <mat-icon style="float: left;cursor: pointer;" svgIcon="mat:edit" (click)="goTo('/bookings/update/' + detailData.id)"></mat-icon>

        </div>
        <div style="width: 100%;float:left;">
          <mat-card-title style="float: left;width: 90%;">{{'booking' | translate}} #{{detailData.id}}</mat-card-title>
        </div>
        <div style="width:100%; margin-top:5%;float:left">
          <div style="width: 100%;">
            <p style="float: left;width: 80%;text-align: left;"><b>{{ 'register' | translate}}</b></p>
            <p style="float: left;width: 20%;text-align: right;"><b>{{ 'status' | translate}}</b></p>
          </div>
          <div style="width: 100%;">
            <p style="float: left;width: 60%;text-align: left;"><b>{{detailData.created_at | date: 'dd/MM/YYYY'}}</b> {{detailData.created_at | date: 'HH:mm'}}</p>
            <p style="float: left;width: 40%;text-align: right;color:#5ade47" *ngIf="detailData.status === 1 && detailData.paid">{{'payed' | translate | uppercase }}</p>
            <p style="float: left;width: 40%;text-align: right;color:#dbd616" *ngIf="detailData.status === 1 && !detailData.paid">{{'no_payed' | translate | uppercase }}</p>
            <p style="float: left;width: 40%;text-align: right;color:#dbd616" *ngIf="detailData.status === 2">{{'cancelled' | translate | uppercase }}</p>
            <p style="float: left;width: 40%;text-align: right;color:#dbd616" *ngIf="detailData.status === 3">{{'partial_cancelled' | translate | uppercase }}</p>
          </div>
        </div>
        <mat-divider style="float: left;width: 100%;margin: 5% 0 5% 0;"></mat-divider>
      </mat-card-header>
      <mat-card-content>
        <div style="float: left; width: 100%;">
          <div style="float: left; width: 100%;">
            <p style="font-size: 20px;">{{'client' | translate}}</p>
          </div>
          <div style="float: left;width: 100%;">
            <div style="float: left; width: 20%; margin-top: 5%">
              <!--<img [src]="getClient(detailData.client_main_id)?.image !== null ? getClient(detailData.client_main_id)?.image : imageAvatar" width="100" height="100" style="border-radius: 100%">-->

              <app-level-user *ngIf="detailData.degrees_sport && detailData.degrees_sport.length" [allLevels]="detailData.degrees_sport"
                [selectLevel]="getClientDegree(detailData?.client_main_id)" [size]="60" [userImage]="getClient(detailData.client_main_id)?.image !== null ? getClient(detailData.client_main_id)?.image : imageAvatar"></app-level-user>

            </div>
            <div style="float: left; width: 75%;margin:6% 0 0 2%">
              <p>{{getLanguage(getClient(detailData?.client_main_id)?.language1_id)}} · {{ getCountry(getClient(detailData?.client_main_id)?.country) }} · {{calculateAge(getClient(detailData?.client_main_id)?.birth_date)}} &ensp;{{'years' | translate}}</p>
              <p><strong>{{getClient(detailData?.client_main_id)?.first_name}} {{getClient(detailData?.client_main_id)?.last_name}} </strong></p>
              <div>
                <mat-icon style="color:white" svgIcon="mat:chat" ></mat-icon>
                <a href="mailto:{{getClient(detailData?.client_main_id)?.email}}" style="cursor:pointer">
                  <mat-icon style="color:white" svgIcon="mat:mail_outline"></mat-icon>
                </a>
                <a href="tel:{{getClient(detailData?.client_main_id)?.phone}}">
                  <mat-icon style="color:white" svgIcon="mat:contact_phone"></mat-icon>
                </a>
              </div>
            </div>
          </div>
        </div>
        <mat-divider style="float: left;width: 100%;margin: 5% 0 5% 0;"></mat-divider>
        <ng-container>
          <div style="float: left; width: 100%;">
            <div style="float: left; width: 15%;margin: 2% 0 0 0 ">
              <!--<img [src]="getClient(detailData.bookingusers[0].client_id)?.image !== null ? getClient(detailData.bookingusers[0].client_id)?.image : imageAvatar" width="50" height="50" style="border-radius: 100%">-->


              <app-level-user *ngIf="detailData.degrees_sport && detailData.degrees_sport.length" [allLevels]="detailData.degrees_sport"
                [selectLevel]="getClientDegree(detailData.bookingusers[0].client_id)" [size]="44" [userImage]="getClient(detailData.bookingusers[0].client_id)?.image !== null ? getClient(detailData.bookingusers[0].client_id)?.image : imageAvatar"></app-level-user>

            </div>
            <div style="float: left; width: 65%;">
              <p>{{getLanguage(getClient(detailData.bookingusers[0]?.client_id)?.language1_id)}} · {{ getCountry(getClient(detailData.bookingusers[0]?.client_id)?.country) }} · {{calculateAge(getClient(detailData.bookingusers[0]?.client_id)?.birth_date)}} &ensp;{{'years' | translate}}</p>
                <p>{{getClient(detailData.bookingusers[0]?.client_id)?.first_name}} {{getClient(detailData.bookingusers[0]?.client_id)?.last_name}} </p>
            </div>
            <div style="float: left; width: 20%;">
              <p style="text-align: right;color:#5ade47" *ngIf="detailData.bookingusers[0]?.status === 1 && detailData.paid">{{'payed' | translate}}</p>
              <p style="text-align: right;color:#dbd616" *ngIf="detailData.bookingusers[0]?.status === 1 && !detailData.paid">{{'no_payed' | translate }}</p>
              <p style="text-align: right;color:#dbd616"*ngIf="detailData.bookingusers[0]?.status === 2">{{'cancelled' | translate | uppercase }}</p>
            </div>
          </div>
          <mat-divider style="float: left;width: 100%;margin: 5% 0 5% 0;"></mat-divider>
          <div style="float: left; width: 100%;">
            <div style="float: left; width: 50%;">
              <div style="float: left; width: 100%;">
                <p style="float: left; width: 100%; font-size: 18px">
                  <strong>{{detailData.bookingusers[0]?.course?.name}}</strong>
                </p>
                <p style="float: left; width: 100%;">
                  {{detailData.bookingusers[0]?.course?.type === 1 ? 'colective' : 'private' | translate}} {{getSportName(detailData.bookingusers[0]?.course?.sport_id)}} {{detailData.bookingusers[0]?.price}} {{detailData.bookingusers[0]?.currency}}
                </p>
              </div>
              <div style="float: left; width: 100%;" *ngIf="detailData.bookingusers[0].course.type">
                <div style="float: left; width: 75%;color:#fff; padding:5%;margin-top: 5%;font-size:12px" [ngStyle]="{'background-color': getDegree(detailData.bookingusers[0]?.degree_id)?.color}">
                  {{getDegree(detailData.bookingusers[0]?.degree_id)?.league}} - {{getDegree(detailData.bookingusers[0]?.degree_id)?.annotation}}/{{getDegree(detailData.bookingusers[0]?.degree_id)?.name}}
                </div>

              </div>
              <div style="float: left; width: 100%;margin-top: 5%;" *ngFor="let item of bookingUsersUnique">
                <ul>
                  <li>{{item.date |date: 'dd/MM/YYYY'}} <i>{{item?.hour_start}}h - {{item?.hour_end}}h</i></li>
                </ul>
              </div>
              <div style="float: left; width: 100%;margin-top: 5%;">
                <div style="float: left; width: 20%;">
                  <img [src]="getMonitor(detailData.bookingusers[0]?.monitor_id) ? getMonitor(detailData.bookingusers[0]?.monitor_id)?.image : imageAvatar" style="border-radius: 100%;">
                </div>
                <div style="float: left; width: 80%;" *ngIf="getMonitor(detailData.bookingusers[0].monitor_id)">


                  <p>
                    <span *ngIf="detailData.color !== ''" class="dot" [ngStyle]="{'background': detailData.color}"></span>
                    {{getMonitor(detailData.bookingusers[0]?.monitor_id)?.first_name}} {{getMonitor(detailData.bookingusers[0]?.monitor_id)?.last_name}}</p>
                  <p style="font-size:8px"><i>{{getLanguage(getMonitor(detailData.bookingusers[0]?.monitor_id)?.language1_id)}} · {{ getCountry(getMonitor(detailData.bookingusers[0]?.monitor_id)?.country) }} · {{calculateAge(getMonitor(detailData.bookingusers[0]?.monitor_id)?.birth_date)}} {{'years' | translate }}</i></p>
                </div>
                <div style="float: left; width: 80%;" *ngIf="!getMonitor(detailData.bookingusers[0]?.monitor_id)">
                  <p style="margin: 5% 0 0 5%;">{{'no_monitor' | translate}}</p>
                </div>
                <div style="float: left;width: 100%;margin: 2% 0 2% 0; padding:2%; color: #fff"
                    [ngStyle]="{'background': getDegree(detailData.bookingusers[0]?.degree_id)?.color !== null ? getDegree(detailData.bookingusers[0]?.degree_id)?.color : ''}">
                  {{getDegree(detailData.bookingusers[0]?.degree_id)?.annotation}} {{getDegree(detailData.bookingusers[0]?.degree_id)?.level}}
                </div>
              </div>
              <div style="float: left; width: 100%;margin-top: 5%;">
                <mat-slide-toggle [disabled]="true" [checked]="detailData?.has_cancellation_insurance"></mat-slide-toggle> Op. Rem
              </div>
              <div style="float: left; width: 100%;margin-top: 5%;">
                <mat-slide-toggle [disabled]="true" [checked]="detailData?.has_boukii_care"></mat-slide-toggle> Boukii Care
              </div>
            </div>
            <div style="float: left; width: 50%;">
              <div style="float: left; width: 100%;" *ngIf="false">
                <mat-slide-toggle></mat-slide-toggle> Alquiler material

              </div>
              <div style="float: left; width: 100%;margin-top: 5%;">
                <mat-slide-toggle [disabled]="true" [checked]="detailData.bookingusers[0]?.courseExtras?.length > 0"></mat-slide-toggle> Fortrait

              </div>
              <div style="float: left; width: 100%;margin-top: 5%;" *ngIf="false">
                <mat-slide-toggle></mat-slide-toggle> Comida

              </div>
              <div style="float: left; width: 100%;margin-top: 5%;" *ngIf="false">
                <mat-slide-toggle></mat-slide-toggle> Transporte

              </div>
            </div>

          </div>
          <mat-divider style="float: left;width: 100%;margin: 5% 0 5% 0;"></mat-divider>

        </ng-container>
        <div style="float: left; width: 100%;margin-top:5%;padding:2%;background:#EFEFEF">

          <div style="text-align: left;width: 50%;float:left">
            <ul>
              <li *ngIf="detailData?.has_cancellation_insurance">{{'op_rem' | translate}}</li>
              <li *ngIf="detailData?.has_boukii_care">{{'Boukii Care'}}</li>
              <li *ngIf="existExtras()">{{'extras' | translate}}</li>
              <li *ngIf="bonus?.length > 0">{{'bonus' | translate}}</li>
              <li *ngIf="getTVA()">{{'tva' |translate}}</li>
              <li><strong>{{'total' | translate | uppercase}}</strong></li>
            </ul>
          </div>
          <div style="text-align: right;width: 50%;float:left">
            <ul>
              <li *ngIf="detailData?.has_cancellation_insurance"> {{detailData.price_cancellation_insurance}} {{detailData.currency}}</li>
              <li *ngIf="detailData?.has_boukii_care">{{detailData.price_boukii_care}} {{detailData.currency}}</li>
              <li *ngIf="existExtras()">{{getExtrasPrice()}} {{detailData.currency}}</li>
              <li *ngIf="bonus?.length > 0">-{{getBonusPrice()}} {{detailData.currency}}</li>
              <li *ngIf="getTVA()">{{(detailData?.price_total * getTVAValue()).toFixed(2)}} {{detailData.currency}}</li>
              <li><strong>{{detailData?.price_total}} {{detailData.currency}}</strong></li>
            </ul>
          </div>
        </div>
      </mat-card-content>
    </mat-card>
  </vex-page-layout-content>
</vex-page-layout>
