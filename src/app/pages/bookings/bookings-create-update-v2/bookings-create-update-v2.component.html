<ng-container *ngIf="!isDetail">
  <div class="barWrapper">
    <vex-breadcrumbs
      class="booking-breadcrumb"
      [crumbs]="[
      { icon: 'reservas' },
      { text: 'bookings', title: true, link: '/bookings' },
      { text: 'bookings_page.creation.title', subtitle: true }
    ]"></vex-breadcrumbs>
  </div>
  <div class="barWrapper">
    <div>
      <button [disabled]="forms.length"
        class="crumb"
        [ngClass]="{ active: currentStep === 0, prev: currentStep > 0 }"
        (click)="forceChange(0)">
        {{ "bookings_page.crumbs.client" | translate }}
      </button>
      <button
        class="crumb"
        [ngClass]="{ active: currentStep === 1, prev: currentStep > 1 }"
        (click)="forceChange(1)">
        {{ "bookings_page.crumbs.utilizers" | translate }}
      </button>
      <button
        class="crumb"
        [ngClass]="{ active: currentStep === 2, prev: currentStep > 2 }"
        (click)="forceChange(2)">
        {{ "bookings_page.crumbs.sport" | translate }}
      </button>
      <button
        class="crumb"
        [ngClass]="{ active: currentStep === 3, prev: currentStep > 3 }"
        (click)="forceChange(3)">
        {{ "bookings_page.crumbs.course" | translate }}
      </button>
      <button
        class="crumb"
        [ngClass]="{ active: currentStep === 4, prev: currentStep > 4 }"
        (click)="forceChange(4)">
        {{ "bookings_page.crumbs.details" | translate }}
      </button>
      <button
        class="crumb last"
        [ngClass]="{ active: currentStep === 5, prev: currentStep > 5 }"
        (click)="forceChange(5)">
        {{ "bookings_page.crumbs.observations" | translate }}
      </button>
    </div>
    <div *ngIf="mainClient" class="clientDescription">
      <span> {{ "bookings_page.crumbs.client" | translate }}: </span>
      {{ mainClient.first_name }} {{ mainClient.last_name }}
    </div>
  </div>
  <div class="bookingContainer">
    <button
      mat-button
      type="button"
      class="modalButton"
      (click)="openBookingDialog()">
      {{ "bookings_page_descriptionModal_button" | translate }}
    </button>
    <mat-card class="left-column">
      <div *ngIf="forceStep < 5 && selectedIndexForm != null">
        Una vez que selecciones continuar en esté paso se reiniciaran y
        eliminarán todas las selecciones de los pasos siguientes.
      </div>
      <booking-form-stepper
        [forceStep]="forceStep"
        [activitiesBooked]="normalizedDates"
        [selectedForm]="selectedForm"
        (changedCurrentStep)="currentStep = $event; forceStep = $event;"
        (changedFormData)="handleFormChange($event)"></booking-form-stepper>
    </mat-card>
    <mat-card class="right-column">
      <booking-description-card
        [utilizers]="utilizers"
        [sport]="sport"
        [sportLevel]="sportLevel"
        [course]="course"
        [dates]="dates"
        [monitors]="monitors"
        [clientObs]="clientObs"
        [schoolObs]="schoolObs"
        [total]="total">
      </booking-description-card>
      <button *ngIf="selectedIndexForm != null"
        mat-button
        type="button"
        (click)="isDetail = true">
        {{ "Volver a la pagina de pago" | translate }}
      </button>
    </mat-card>
  </div>
</ng-container>
<ng-container *ngIf="isDetail">
  <div class="bookingDetailContainer">
    <button
      mat-button
      type="button"
      class="modalButton"
      (click)="openBookingDialog()">
      {{ "bookings_page_descriptionModal_button" | translate }}
    </button>
    <div class="left-column">
      <div class="activities">
        <booking-description-card
          *ngFor="let activity of normalizedDates; let i = index"
          [utilizers]="activity.utilizers"
          [sport]="activity.sport"
          [sportLevel]="activity.sportLevel"
          [course]="activity.course"
          [dates]="activity.dates"
          [monitors]="activity.monitors"
          [clientObs]="activity.clientObs"
          [schoolObs]="activity.schoolObs"
          [total]="total"
          [isDetail]="true"
          [summaryMode]="true"
          [index]="i"
          (editActivity)="editActivity($event, i)">
          (deleteActivity)="deleteModal=true; deleteIndex=i">
        </booking-description-card>
      </div>
    </div>
    <div class="right-column">
      <booking-reservation-detail
        [client]="mainClient"
        [activities]="normalizedDates"
        (endClick)="isDetail = false;endModal=true"
        (addClick)="addNewActivity()">
      </booking-reservation-detail>
    </div>
  </div>
</ng-container>

<vex-flux-modal *ngIf="deleteModal" (Close)="deleteModal=false"
  [width]="570" title="Eliminar actividad">
  <div body>
    <div style="margin: 10px;">
      Quieres cancelar “Actividad #{{("00"+deleteIndex).slice(-2)}}”?
    </div>
  </div>
  <div footer style="display: flex;">
    <button
      style="height: 38px; width: 85px;border-radius: 3px;margin-top: 20px; margin-left: auto;"
      mat-raised-button
      type="button"
      class="client-button" (click)="deleteModal=false">
      {{"Cancelar" | translate }}
    </button>
    <button
      style="height: 38px; width: 85px;border-radius: 3px;margin-top:20px;margin-left: 20px;"
      color="primary"
      mat-raised-button
      type="button"
      class="client-button">
      {{ "Si, eliminar" | translate }}
    </button>
  </div>
</vex-flux-modal>

<vex-flux-modal *ngIf="endModal" (Close)="endModal=false"
  [width]="570" title="Finalizar reserva">
  <div body>
    <div style="margin: 10px;">
      Si dejas esta pagina los datos no se guardarán los datos de la reserva,
      <br>
      Estás seguro?
    </div>
  </div>
  <div footer style="display: flex;">
    <button
      style="height: 38px; width: 150px;border-radius: 3px;margin-top: 20px; margin-left: auto;"
      mat-raised-button
      type="button"
      class="client-button" (click)="endModal=false">
      {{"Salir de la reserva" | translate }}
    </button>
    <button
      style="height: 38px; width: 150px;border-radius: 3px;margin-top:20px;margin-left: 20px;"
      color="primary"
      mat-raised-button
      type="button"
      class="client-button">
      {{ "Finalizar reserva y pagar" | translate }}
    </button>
  </div>
</vex-flux-modal>

<vex-flux-modal *ngIf="editarFechaModal" (Close)="editarFechaModal=false"
  [width]="570" title="Editar fecha 1">
  <div body>

  </div>
  <div footer style="display: flex;">
    <button
      style="height: 38px; width: 85px;border-radius: 3px;margin-top: 20px; margin-left: auto;"
      mat-raised-button
      type="button"
      class="client-button" (click)="editarFechaModal=false">
      {{"Cancelar" | translate }}
    </button>
    <button
      style="height: 38px; width: 85px;border-radius: 3px;margin-top:20px;margin-left: 20px;"
      color="primary"
      mat-raised-button
      type="button"
      class="client-button">
      {{ "Confirmar" | translate }}
    </button>
  </div>
</vex-flux-modal>
