<div class="dashboard-container">
  <!-- Hero Section with Gradient -->
  <div class="hero-section">
    <div class="hero-content">
      <div class="welcome-content">
        <h1 class="welcome-title">
          Â¡Bienvenido de vuelta, {{ currentUser?.name || 'Usuario' }}! ðŸ‘‹
        </h1>
        <p class="welcome-subtitle">
          Tienes {{ dashboardStats?.bookings?.todayCount || 0 }} nuevas reservas hoy y {{ dashboardStats?.courses?.active || 0 }} cursos programados para esta semana. 
          El rendimiento de tu escuela ha mejorado un {{ dashboardStats?.revenue?.growth || 0 }}% este mes.
        </p>
        
        <!-- Quick Actions -->
        <div class="quick-actions">
          <button class="action-btn primary" (click)="navigateToRoute('/v5/bookings')">
            <mat-icon>event_note</mat-icon>
            Ver Reservas
          </button>
          <button class="action-btn secondary" (click)="navigateToRoute('/v5/bookings/new')">
            <mat-icon>add</mat-icon>
            Nueva Reserva
          </button>
          <button class="action-btn secondary" (click)="navigateToRoute('/v5/courses')">
            <mat-icon>school</mat-icon>
            Gestionar Cursos
          </button>
        </div>
        
        <!-- Status Indicators -->
        <div class="status-indicators">
          <div class="status-item">
            <mat-icon class="status-icon active">group</mat-icon>
            <span class="status-text">{{ monitorStats?.active || 0 }} monitores activos</span>
          </div>
          <div class="status-item">
            <mat-icon class="status-icon available">check_circle</mat-icon>
            <span class="status-text">{{ monitorStats?.available || 0 }} disponibles</span>
          </div>
          <div class="status-item">
            <mat-icon class="status-icon unavailable">block</mat-icon>
            <span class="status-text">{{ monitorStats?.onLeave || 0 }}h disponibles</span>
          </div>
        </div>
      </div>
      
      <!-- Weather Section -->
      <div class="weather-section" *ngIf="weatherData">
        <div class="weather-card">
          <div class="weather-main">
            <div class="temperature">{{ weatherData.temperature | number:'1.0-0' }}Â°</div>
            <div class="condition">{{ getWeatherConditionText(weatherData.condition) }}</div>
          </div>
          <div class="weather-details">
            <div class="weather-detail">
              <mat-icon>air</mat-icon>
              <span>{{ weatherData.windSpeed }} km/h</span>
              <span class="detail-label">Viento</span>
            </div>
            <div class="weather-detail">
              <mat-icon>visibility</mat-icon>
              <span>{{ weatherData.visibility }} km</span>
              <span class="detail-label">Visibilidad</span>
            </div>
            <div class="weather-detail">
              <mat-icon>opacity</mat-icon>
              <span>{{ weatherData.humidity }}%</span>
              <span class="detail-label">Humedad</span>
            </div>
            <div class="weather-detail">
              <mat-icon>ac_unit</mat-icon>
              <span>{{ weatherData.forecast?.[0]?.precipitationChance || 0 }}%</span>
              <span class="detail-label">Nieve prevista</span>
            </div>
          </div>
        </div>
        <div class="date-info">
          <span>Hoy 23 Jul</span>
        </div>
      </div>
    </div>
    
    <!-- Skier Illustration -->
    <div class="hero-illustration">
      <div class="skier-figure">
        <mat-icon class="skier-icon">downhill_skiing</mat-icon>
      </div>
    </div>
  </div>

  <!-- Stats Cards Row -->
  <div class="stats-row">
    <!-- Private Courses -->
    <div class="stat-card">
      <div class="stat-content">
        <div class="stat-number">{{ dashboardStats?.courses?.active || 24 }}</div>
        <div class="stat-label">Cursos Privados</div>
        <div class="stat-change negative">+5% vs dia anterior</div>
      </div>
      <div class="stat-icon private-courses">
        <mat-icon>person</mat-icon>
      </div>
    </div>

    <!-- Group Courses -->
    <div class="stat-card">
      <div class="stat-content">
        <div class="stat-number">{{ (dashboardStats?.bookings?.confirmed || 0) + 44 }}</div>
        <div class="stat-label">Cursos Colectivos</div>
        <div class="stat-change positive">+6% vs dia anterior</div>
      </div>
      <div class="stat-icon group-courses">
        <mat-icon>groups</mat-icon>
      </div>
    </div>

    <!-- Active Bookings -->
    <div class="stat-card">
      <div class="stat-content">
        <div class="stat-number">{{ dashboardStats?.bookings?.confirmed || 89 }}</div>
        <div class="stat-label">Reservas Activas</div>
        <div class="stat-change positive">+23% vs dia anterior</div>
      </div>
      <div class="stat-icon active-bookings">
        <mat-icon>event_available</mat-icon>
      </div>
    </div>

    <!-- Daily Sales -->
    <div class="stat-card">
      <div class="stat-content">
        <div class="stat-number">â‚¬{{ (dashboardStats?.revenue?.dailyAverage || 2340) | number:'1.0-0' }}</div>
        <div class="stat-label">Ventas Totales del DÃ­a</div>
        <div class="stat-change positive">+18% vs dia anterior</div>
      </div>
      <div class="stat-icon daily-sales">
        <mat-icon>euro</mat-icon>
      </div>
    </div>
  </div>

  <!-- Charts Section -->
  <div class="charts-section">
    <!-- Sales by Channel Chart -->
    <div class="chart-card sales-chart">
      <div class="chart-header">
        <h3>Ventas por Canal</h3>
        <span class="chart-period">Ãšltimos 7 meses</span>
      </div>
      <div class="chart-content">
        <!-- Sales Channel Stats -->
        <div class="sales-stats">
          <div class="sales-totals">
            <div class="total-item">
              <div class="total-label">Total Admis</div>
              <div class="total-amount">â‚¬22.320</div>
              <div class="total-change">+6% del total</div>
            </div>
            <div class="total-item">
              <div class="total-label">Total Online</div>
              <div class="total-amount red">â‚¬14.880</div>
              <div class="total-change">-2% del total</div>
            </div>
            <div class="total-item">
              <div class="total-label">Total Ventas</div>
              <div class="total-amount green">â‚¬37.200</div>
              <div class="total-change green">+13% vs mes anterior</div>
            </div>
          </div>
        </div>
        <!-- Placeholder for chart -->
        <div class="chart-placeholder">
          <div class="chart-area">
            <svg viewBox="0 0 400 200" class="chart-svg">
              <!-- Grid lines -->
              <defs>
                <pattern id="grid" width="40" height="25" patternUnits="userSpaceOnUse">
                  <path d="M 40 0 L 0 0 0 25" fill="none" stroke="#f0f0f0" stroke-width="1"/>
                </pattern>
              </defs>
              <rect width="100%" height="100%" fill="url(#grid)" />
              
              <!-- Chart lines -->
              <path d="M 20 150 Q 80 140 120 120 T 200 100 T 280 80 T 360 70" 
                    fill="none" stroke="#8b5cf6" stroke-width="2" stroke-dasharray="5,5"/>
              <path d="M 20 180 Q 80 170 120 160 T 200 150 T 280 140 T 360 130" 
                    fill="none" stroke="#06b6d4" stroke-width="2"/>
              <path d="M 20 120 Q 80 110 120 100 T 200 90 T 280 85 T 360 80" 
                    fill="none" stroke="#10b981" stroke-width="3"/>
              
              <!-- Area fill for main line -->
              <path d="M 20 120 Q 80 110 120 100 T 200 90 T 280 85 T 360 80 L 360 200 L 20 200 Z" 
                    fill="url(#gradient)" opacity="0.2"/>
              
              <defs>
                <linearGradient id="gradient" x1="0%" y1="0%" x2="0%" y2="100%">
                  <stop offset="0%" style="stop-color:#10b981;stop-opacity:0.3" />
                  <stop offset="100%" style="stop-color:#10b981;stop-opacity:0" />
                </linearGradient>
              </defs>
              
              <!-- Data points -->
              <circle cx="120" cy="100" r="3" fill="#10b981"/>
              <circle cx="200" cy="90" r="3" fill="#10b981"/>
              <circle cx="280" cy="85" r="3" fill="#10b981"/>
              <circle cx="360" cy="80" r="3" fill="#10b981"/>
            </svg>
          </div>
          
          <!-- Legend -->
          <div class="chart-legend">
            <div class="legend-item">
              <div class="legend-color objective"></div>
              <span>Objetivo</span>
            </div>
            <div class="legend-item">
              <div class="legend-color admin"></div>
              <span>Ventas Admin</span>
            </div>
            <div class="legend-item">
              <div class="legend-color online"></div>
              <span>Ventas Online</span>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Daily Sessions Chart -->
    <div class="chart-card sessions-chart">
      <div class="chart-header">
        <h3>Sesiones Diarias</h3>
        <span class="chart-period">Esta semana</span>
      </div>
      <div class="chart-content">
        <!-- Bar chart placeholder -->
        <div class="bar-chart">
          <div class="bar-item" *ngFor="let session of recentSessions; let i = index">
            <div class="bar-container">
              <div class="bar morning" [style.height.%]="(session.morningSlots / 30) * 100"></div>
              <div class="bar afternoon" [style.height.%]="(session.afternoonSlots / 30) * 100"></div>
            </div>
            <div class="bar-label">{{ getDayName(i) }}</div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Today's Reservations -->
  <div class="reservations-section">
    <div class="reservations-header">
      <h3>
        <mat-icon>event</mat-icon>
        Reservas de Hoy
      </h3>
      <div class="reservations-summary">
        {{ dashboardStats?.todayReservations?.length || 6 }} confirmadas, {{ (dashboardStats?.bookings?.pending || 0) % 5 || 2 }} pendientes â€¢ 31 jul 2025
      </div>
      <button class="agenda-btn">
        <mat-icon>calendar_month</mat-icon>
        Agenda Completa
      </button>
    </div>

    <!-- Reservations Table -->
    <div class="reservations-table">
      <div class="table-header">
        <div class="col-id">ID</div>
        <div class="col-type">Tipo</div>
        <div class="col-course">Curso</div>
        <div class="col-client">Cliente</div>
        <div class="col-instructor">Instructor</div>
        <div class="col-time">Hora</div>
        <div class="col-status">Estado</div>
        <div class="col-price">Precio</div>
        <div class="col-actions"></div>
      </div>

      <div class="table-body">
        <div class="table-row" *ngFor="let reservation of displayReservations; let i = index">
          <div class="col-id">{{ reservation.id }}</div>
          <div class="col-type">
            <span class="course-type" [class]="getReservationTypeClass(reservation.courseType)">
              {{ getReservationTypeLabel(reservation.courseType) }}
            </span>
          </div>
          <div class="col-course">{{ reservation.courseType }}</div>
          <div class="col-client">
            <div class="client-info">
              <div class="client-avatar">{{ getClientInitials(reservation.clientName) }}</div>
              <div class="client-details">
                <div class="client-name">{{ reservation.clientName }}</div>
                <div class="client-email">{{ getClientEmail(reservation.clientName) }}</div>
              </div>
            </div>
          </div>
          <div class="col-instructor">{{ reservation.monitorName || 'Sin asignar' }}</div>
          <div class="col-time">
            <mat-icon class="time-icon">schedule</mat-icon>
            {{ reservation.startTime }}
          </div>
          <div class="col-status">
            <span class="status-badge" [class]="reservation.status">
              {{ getStatusLabel(reservation.status) }}
            </span>
          </div>
          <div class="col-price">â‚¬{{ getReservationPrice(reservation.courseType) }}</div>
          <div class="col-actions">
            <button class="action-btn-small">
              <mat-icon>more_horiz</mat-icon>
            </button>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Loading Overlay -->
  <div class="loading-overlay" *ngIf="loading">
    <mat-spinner diameter="50"></mat-spinner>
    <p>Cargando dashboard...</p>
  </div>
</div>