<!-- Season Selection Modal/Overlay -->
<div class="season-selector-overlay" [class.modal-overlay]="showAsModal" *ngIf="showAsModal" data-cy="season-selector-modal">
  <div class="season-selector-container" [class.modal-container]="showAsModal">
    <div class="season-selector-card">
      <!-- Header -->
      <div class="selector-header">
        <h2 class="selector-title">
          <mat-icon>calendar_today</mat-icon>
          Seleccionar Temporada
        </h2>
        <p class="selector-subtitle">
          Para continuar, necesitas seleccionar una temporada de trabajo
        </p>
      </div>

      <!-- Loading State -->
      <div *ngIf="isLoading" class="loading-container">
        <mat-spinner diameter="40"></mat-spinner>
        <p>Procesando...</p>
      </div>

      <!-- Season Selection Content -->
      <div *ngIf="!isLoading" class="selector-content">
        
        <!-- Recommended Season (if available) -->
        <div *ngIf="recommendedSeason" class="recommended-season">
          <div class="recommendation-header">
            <mat-icon class="recommendation-icon">star</mat-icon>
            <h3>Temporada Recomendada</h3>
          </div>
          <div class="season-card recommended">
            <div class="season-info">
              <h4>{{ recommendedSeason.name }}</h4>
              <p class="season-dates">
                {{ recommendedSeason.start_date | date:'dd/MM/yyyy' }} - 
                {{ recommendedSeason.end_date | date:'dd/MM/yyyy' }}
              </p>
              <span class="season-badge current">Actual</span>
            </div>
            <button 
              mat-raised-button 
              color="primary" 
              (click)="selectRecommendedSeason()"
              class="select-button"
            >
              Seleccionar
            </button>
          </div>
        </div>

        <!-- Available Seasons -->
        <div *ngIf="availableSeasons.length > 0" class="available-seasons">
          <h3>Temporadas Disponibles</h3>
          <div class="seasons-grid">
            <div 
              *ngFor="let season of availableSeasons" 
              class="season-card"
              [class.recommended-highlight]="season.id === recommendedSeason?.id"
            >
              <div class="season-info">
                <h4>{{ season.name }}</h4>
                <p class="season-dates">
                  {{ season.start_date | date:'dd/MM/yyyy' }} - 
                  {{ season.end_date | date:'dd/MM/yyyy' }}
                </p>
                <div class="season-badges">
                  <span *ngIf="season.is_current" class="season-badge current">Actual</span>
                  <span *ngIf="season.is_historical" class="season-badge historical">Hist√≥rica</span>
                  <span *ngIf="!season.is_active" class="season-badge inactive">Inactiva</span>
                </div>
              </div>
              <button 
                mat-stroked-button 
                (click)="selectSeason(season)"
                class="select-button"
                [disabled]="season.id === recommendedSeason?.id"
              >
                {{ season.id === recommendedSeason?.id ? 'Recomendada' : 'Seleccionar' }}
              </button>
            </div>
          </div>
        </div>

        <!-- No Seasons Available -->
        <div *ngIf="availableSeasons.length === 0 && !recommendedSeason" class="no-seasons">
          <mat-icon class="no-seasons-icon">event_busy</mat-icon>
          <h3>No hay temporadas disponibles</h3>
          <p>Necesitas crear una nueva temporada para continuar</p>
        </div>

        <!-- Create New Season Section -->
        <div class="create-season-section">
          <div class="create-season-header">
            <button 
              mat-button 
              (click)="toggleCreateForm()" 
              class="toggle-create-button"
              data-cy="create-season-button"
            >
              <mat-icon>{{ showCreateForm ? 'remove' : 'add' }}</mat-icon>
              {{ showCreateForm ? 'Cancelar' : 'Crear Nueva Temporada' }}
            </button>
          </div>

          <!-- Create Season Form -->
          <div *ngIf="showCreateForm" class="create-season-form" data-cy="season-creation-form">
            <form [formGroup]="newSeasonForm" (ngSubmit)="createNewSeason()">
              <mat-form-field appearance="outline" class="full-width">
                <mat-label>Nombre de la Temporada</mat-label>
                <input 
                  matInput 
                  formControlName="name" 
                  placeholder="Ej: Temporada 2024-2025"
                  data-cy="season-name-input"
                />
                <mat-error *ngIf="newSeasonForm.get('name')?.touched && newSeasonForm.get('name')?.invalid">
                  {{ getFormFieldError('name') }}
                </mat-error>
              </mat-form-field>

              <div class="date-fields">
                <mat-form-field appearance="outline" class="date-field">
                  <mat-label>Fecha de Inicio</mat-label>
                  <input 
                    matInput 
                    type="date" 
                    formControlName="start_date"
                    data-cy="season-start-date-input"
                  />
                  <mat-error *ngIf="newSeasonForm.get('start_date')?.touched && newSeasonForm.get('start_date')?.invalid">
                    {{ getFormFieldError('start_date') }}
                  </mat-error>
                </mat-form-field>

                <mat-form-field appearance="outline" class="date-field">
                  <mat-label>Fecha de Fin</mat-label>
                  <input 
                    matInput 
                    type="date" 
                    formControlName="end_date"
                    data-cy="season-end-date-input"
                  />
                  <mat-error *ngIf="newSeasonForm.get('end_date')?.touched && newSeasonForm.get('end_date')?.invalid">
                    {{ getFormFieldError('end_date') }}
                  </mat-error>
                </mat-form-field>
              </div>

              <div class="form-actions">
                <button 
                  type="button" 
                  mat-button 
                  (click)="toggleCreateForm()"
                  class="cancel-button"
                >
                  Cancelar
                </button>
                <button 
                  type="submit" 
                  mat-raised-button 
                  color="primary"
                  [disabled]="newSeasonForm.invalid"
                  class="create-button"
                  data-cy="create-season-submit"
                >
                  Crear y Seleccionar
                </button>
              </div>
            </form>
          </div>
        </div>
      </div>

      <!-- Modal Footer (only in modal mode) -->
      <div *ngIf="showAsModal && !isLoading" class="selector-footer">
        <button mat-button (click)="cancel()" class="cancel-button">
          Cancelar
        </button>
      </div>
    </div>
  </div>
</div>

<!-- Inline Content (when not used as modal) -->
<div *ngIf="!showAsModal" class="season-selector-inline">
  <!-- Same content as above but without modal wrapper -->
  <!-- This allows the component to be used inline as well -->
</div>
