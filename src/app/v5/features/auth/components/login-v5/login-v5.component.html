<div class="login-container" [@slideInUp]>
  <!-- Background Elements -->
  <div class="login-background">
    <div class="background-gradient"></div>
    <div class="background-pattern"></div>
  </div>

  <!-- Main Login Card -->
  <div class="login-card" [@staggerForm]>
    <!-- Header Section -->
    <div class="login-header">
      <div class="logo-section">
        <img src="assets/images/boukii-logo-v5.svg" 
             alt="{{ 'auth.boukii_logo' | translate }}" 
             class="login-logo"
             width="120" 
             height="40">
        <h1 class="login-title">{{ 'auth.welcome_back' | translate }}</h1>
        <p class="login-subtitle">{{ 'auth.sign_in_to_continue' | translate }}</p>
      </div>
    </div>

    <!-- Login Form -->
    <form [formGroup]="loginForm" 
          (ngSubmit)="onSubmit()" 
          class="login-form"
          novalidate
          [@errorShake]="formAnimationState">

      <!-- Global Error Alert -->
      <div class="form-error-alert" 
           *ngIf="loginError$ | async as error" 
           [@fadeInOut]
           role="alert"
           [attr.id]="formErrorId"
           [attr.aria-live]="'polite'">
        <mat-icon class="error-icon">error_outline</mat-icon>
        <span class="error-message">{{ error }}</span>
        <button type="button" 
                mat-icon-button 
                class="error-close"
                (click)="loginError$.next(null)"
                [attr.aria-label]="'common.close' | translate">
          <mat-icon>close</mat-icon>
        </button>
      </div>

      <!-- Email Field -->
      <div class="form-field" [@fadeInOut]>
        <mat-form-field appearance="outline" class="full-width">
          <mat-label>{{ 'auth.email_address' | translate }}</mat-label>
          <input matInput
                 #emailInput
                 type="email"
                 formControlName="email"
                 [placeholder]="'auth.email_placeholder' | translate"
                 autocomplete="email"
                 [attr.aria-describedby]="getAriaDescribedBy('email')"
                 [attr.aria-invalid]="hasFieldError('email')"
                 (keydown)="onKeyDown($event)"
                 required>
          
          <mat-icon matPrefix class="field-icon">email</mat-icon>
          
          <mat-hint *ngIf="!hasFieldError('email')">
            {{ 'auth.email_hint' | translate }}
          </mat-hint>
          
          <mat-error [attr.id]="emailErrorId" *ngIf="hasFieldError('email')">
            {{ getFieldError('email') }}
          </mat-error>
        </mat-form-field>
      </div>

      <!-- Password Field -->
      <div class="form-field" [@fadeInOut]>
        <mat-form-field appearance="outline" class="full-width">
          <mat-label>{{ 'auth.password' | translate }}</mat-label>
          <input matInput
                 #passwordInput
                 [type]="showPassword ? 'text' : 'password'"
                 formControlName="password"
                 [placeholder]="'auth.password_placeholder' | translate"
                 autocomplete="current-password"
                 [attr.aria-describedby]="getAriaDescribedBy('password')"
                 [attr.aria-invalid]="hasFieldError('password')"
                 (keydown)="onKeyDown($event)"
                 required>
          
          <mat-icon matPrefix class="field-icon">lock</mat-icon>
          
          <button matSuffix
                  type="button"
                  mat-icon-button
                  (click)="togglePasswordVisibility()"
                  [attr.aria-label]="showPassword ? ('auth.hide_password' | translate) : ('auth.show_password' | translate)"
                  class="password-toggle">
            <mat-icon>{{ showPassword ? 'visibility_off' : 'visibility' }}</mat-icon>
          </button>
          
          <mat-hint *ngIf="!hasFieldError('password')">
            {{ 'auth.password_hint' | translate }}
          </mat-hint>
          
          <mat-error [attr.id]="passwordErrorId" *ngIf="hasFieldError('password')">
            {{ getFieldError('password') }}
          </mat-error>
        </mat-form-field>
      </div>

      <!-- Remember Me & Forgot Password -->
      <div class="form-options" [@fadeInOut]>
        <mat-checkbox formControlName="rememberMe" 
                      class="remember-me-checkbox"
                      color="primary">
          {{ 'auth.remember_me' | translate }}
        </mat-checkbox>
        
        <button type="button" 
                mat-button 
                class="forgot-password-link"
                (click)="onForgotPassword()">
          {{ 'auth.forgot_password' | translate }}
        </button>
      </div>

      <!-- Login Button -->
      <div class="form-actions" [@fadeInOut]>
        <button type="submit"
                mat-raised-button
                color="primary"
                class="login-button"
                [disabled]="!canSubmit || (isLoading$ | async)"
                [attr.aria-describedby]="loginError$ | async ? formErrorId : null">
          
          <!-- Loading State -->
          <ng-container *ngIf="isLoading$ | async; else loginContent">
            <mat-spinner diameter="20" class="button-spinner"></mat-spinner>
            <span class="button-text">{{ 'auth.signing_in' | translate }}</span>
          </ng-container>
          
          <!-- Normal State -->
          <ng-template #loginContent>
            <mat-icon class="button-icon">login</mat-icon>
            <span class="button-text">{{ 'auth.sign_in' | translate }}</span>
          </ng-template>
        </button>
      </div>

      <!-- Alternative Authentication -->
      <div class="alternative-auth" *ngIf="supportsWebAuthn" [@fadeInOut]>
        <div class="divider">
          <span class="divider-text">{{ 'auth.or' | translate }}</span>
        </div>
        
        <button type="button"
                mat-stroked-button
                class="webauthn-button"
                [disabled]="isLoading$ | async">
          <mat-icon class="button-icon">fingerprint</mat-icon>
          <span class="button-text">{{ 'auth.use_biometric' | translate }}</span>
        </button>
      </div>
    </form>

    <!-- Footer Actions -->
    <div class="login-footer" [@fadeInOut]>
      <div class="footer-content">
        <p class="signup-prompt">
          {{ 'auth.no_account' | translate }}
          <button type="button" 
                  mat-button 
                  color="primary"
                  class="signup-link"
                  (click)="onCreateAccount()">
            {{ 'auth.create_account' | translate }}
          </button>
        </p>
      </div>
    </div>

    <!-- Development Helper -->
    <div class="dev-helper" *ngIf="!environment.production" [@fadeInOut]>
      <button type="button"
              mat-stroked-button
              color="accent"
              class="demo-credentials-btn"
              (click)="fillDemoCredentials()">
        <mat-icon>code</mat-icon>
        Fill Demo Credentials
      </button>
    </div>
  </div>

  <!-- Accessibility Live Region -->
  <div aria-live="polite" aria-atomic="true" class="sr-only">
    <span *ngIf="isLoading$ | async">{{ 'auth.loading_message' | translate }}</span>
    <span *ngIf="loginError$ | async">{{ 'auth.error_occurred' | translate }}</span>
  </div>

  <!-- Footer Links -->
  <div class="page-footer">
    <div class="footer-links">
      <a href="/privacy-policy" 
         class="footer-link"
         target="_blank"
         rel="noopener noreferrer">
        {{ 'auth.privacy_policy' | translate }}
      </a>
      <span class="footer-separator">•</span>
      <a href="/terms-of-service" 
         class="footer-link"
         target="_blank"
         rel="noopener noreferrer">
        {{ 'auth.terms_of_service' | translate }}
      </a>
      <span class="footer-separator">•</span>
      <a href="/support" 
         class="footer-link"
         target="_blank"
         rel="noopener noreferrer">
        {{ 'auth.support' | translate }}
      </a>
    </div>
    
    <div class="footer-language">
      <mat-form-field appearance="outline" class="language-selector">
        <mat-label>{{ 'common.language' | translate }}</mat-label>
        <mat-select [value]="i18n.getCurrentLanguage()" 
                    (selectionChange)="i18n.setLanguage($event.value)">
          <mat-option value="en">English</mat-option>
          <mat-option value="es">Español</mat-option>
          <mat-option value="fr">Français</mat-option>
          <mat-option value="de">Deutsch</mat-option>
          <mat-option value="it">Italiano</mat-option>
        </mat-select>
      </mat-form-field>
    </div>

    <div class="footer-copyright">
      <p>&copy; {{ currentYear }} Boukii. {{ 'auth.all_rights_reserved' | translate }}</p>
    </div>
  </div>
</div>

<!-- Keyboard Shortcuts Helper -->
<div class="keyboard-shortcuts" 
     *ngIf="showKeyboardHelp" 
     [@fadeInOut]
     role="dialog"
     aria-labelledby="keyboard-help-title"
     aria-modal="true">
  <div class="shortcuts-content">
    <h3 id="keyboard-help-title">{{ 'auth.keyboard_shortcuts' | translate }}</h3>
    <ul class="shortcuts-list">
      <li>
        <kbd>Tab</kbd> - {{ 'auth.navigate_fields' | translate }}
      </li>
      <li>
        <kbd>Enter</kbd> - {{ 'auth.submit_form' | translate }}
      </li>
      <li>
        <kbd>Escape</kbd> - {{ 'auth.close_dialogs' | translate }}
      </li>
    </ul>
    <button mat-button (click)="hideKeyboardHelp()">
      {{ 'common.close' | translate }}
    </button>
  </div>
</div>