<div style="overflow-x: auto;overflow-y: hidden; height: 100%;">
  <table>
    <thead>
      <tr style="height: 34px;">
        <td class="monitor-header-cell">
          <div class="flexicon">
            <img src="assets/icons/icon/monitor.png" class="icon24">
            {{'monitor' | translate}}
          </div>
        </td>
        <td *ngFor="let entry of getDatesForSubgroup(); index as i"
          class="date-header-cell"
          [style.backgroundColor]="selectDate===entry.index?'var(--is-light-theme, #ffffff) var(--is-dark-theme, black)':' var(--is-light-theme, #f8f9fb) var(--is-dark-theme, #8e97a7)'"
          [style.borderTop]="selectDate===entry.index?'3px solid #E91E63':''"
          (click)="onSelectDate(entry.index, entry.date)">
          {{entry.date.date | date:'dd/MM/yy'}}
        </td>
      </tr>
    </thead>
    <tbody>
      <tr style="border-bottom: 3px solid #dee6ea;">
        <td class="monitor-column-cell" style="background-color: var(--is-light-theme, #ffffff) var(--is-dark-theme, black);">
          <div class="monitor-assignment-compact"
               *ngIf="courseFormGroup.controls['course_dates'].value?.length && getDatesForSubgroup().length > 1">
            <div class="assignment-inline">
              <span class="assignment-label">{{'monitor_assignment.scope_label' | translate}}:</span>
              <mat-form-field appearance="outline" subscriptSizing="dynamic" class="mini-select">
                <mat-select [(ngModel)]="assignmentScope"
                            (selectionChange)="onAssignmentScopeChange($event.value)">
                  <mat-option value="single">
                    {{'monitor_assignment.scope.single' | translate}}
                  </mat-option>
                  <mat-option value="interval"
                              *ngIf="hasMultipleIntervals()">
                    {{'monitor_assignment.scope.interval' | translate}}
                  </mat-option>
                  <mat-option value="from">
                    {{'monitor_assignment.scope.from' | translate}}
                  </mat-option>
                  <mat-option value="range">
                    {{'monitor_assignment.scope.range' | translate}}
                  </mat-option>
                </mat-select>
              </mat-form-field>
              <mat-form-field appearance="outline"
                              subscriptSizing="dynamic"
                              class="mini-select"
                              *ngIf="assignmentScope !== 'single'">
                <mat-label>{{'monitor_assignment.start_date' | translate}}</mat-label>
                <mat-select [(ngModel)]="assignmentStartIndex"
                            (selectionChange)="onAssignmentStartIndexChange($event.value)">
                  <mat-option *ngFor="let entry of getDatesForSubgroup(); index as idx"
                              [value]="entry.index">
                    {{entry.date.date | date:'dd/MM/yy'}}
                  </mat-option>
                </mat-select>
              </mat-form-field>
              <mat-form-field appearance="outline"
                              subscriptSizing="dynamic"
                              class="mini-select"
                              *ngIf="assignmentScope === 'range'">
                <mat-label>{{'monitor_assignment.end_date' | translate}}</mat-label>
                <mat-select [(ngModel)]="assignmentEndIndex"
                            (selectionChange)="onAssignmentEndIndexChange($event.value)">
                  <mat-option *ngFor="let entry of getDatesForSubgroup(); index as idx"
                              [value]="entry.index">
                    {{entry.date.date | date:'dd/MM/yy'}}
                  </mat-option>
                </mat-select>
              </mat-form-field>
              <span class="days-info" *ngIf="assignmentScope !== 'single'">
                ({{ getAssignmentSelectedDays() }} {{'days' | translate}})
              </span>
            </div>
          </div>
          <app-form-select
            [table]="monitors"
            [value]="getSubgroupForDate(courseFormGroup.controls['course_dates'].value[selectDate])?.monitor
    ? (getSubgroupForDate(courseFormGroup.controls['course_dates'].value[selectDate])?.monitor?.first_name + ' ' +
       getSubgroupForDate(courseFormGroup.controls['course_dates'].value[selectDate])?.monitor?.last_name)
    : ''"
            (do)="SelectMonitor($event,selectDate)"
            name="first_name"
            name2="last_name">
          </app-form-select>
          <div class="level" *ngIf="monitors === undefined || monitors === null"
               style="width: 100%; height: 100%; padding: 10px; background: #F5F5F5; border-radius: 8px; justify-content: flex-start; align-items: center; gap: 8px; display: inline-flex">
            <mat-icon style="color: #666;" class="icon24">
              info
            </mat-icon>
            <div>
              <span style="flex: 1 1 0; font-size: 14px; font-weight: 400; line-height: 18px; word-wrap: break-word;color: #666;">
                {{'select_date_to_load_monitors' | translate}}
              </span>
            </div>
          </div>
          <div class="level" *ngIf="monitors?.length === 0 && !getSubgroupForDate(courseFormGroup.controls['course_dates'].value[selectDate])?.monitor"
               style="width: 100%; height: 100%; padding: 10px; background: #D2EFFF; border-radius: 8px; justify-content: flex-start; align-items: center; gap: 8px; display: inline-flex">
            <mat-icon style="color: #006fcb;" class="icon24">
              info
            </mat-icon>
            <div>
              <span
                style="flex: 1 1 0; font-size: 14px; font-weight: 700; line-height: 18px; word-wrap: break-word;color: red;">
                {{'snackbar.booking.no_match' | translate}}!
              </span>
            </div>
          </div>
        </td>
        <td *ngFor="let entry of getDatesForSubgroup(); index as i"
          class="monitor-status-cell"
          [style.backgroundColor]="selectDate===entry.index?'var(--is-light-theme, #ffffff) var(--is-dark-theme, black)':'var(--is-light-theme, #f8f9fb) var(--is-dark-theme, #8e97a7)'"
          [style.color]="getSubgroupForDate(entry.date)?.monitor ? (modified[entry.index] ? '#FFCF25' : '#31C044') : '#C7D0D3'"
          (click)="onSelectDate(entry.index, entry.date)">
          <mat-icon class="icon10">circle</mat-icon>
        </td>
      </tr>
      <tr style="height: 34px;">
        <td class="monitor-column-cell" style="background-color: var(--is-light-theme, #ffffff) var(--is-dark-theme, black);">
          <div class="flexicon">
            <img src="assets/icons/icon/alumno.png" class="icon24">
            {{'students' | translate}}
            <div style="margin-left: auto; display: flex; align-items: center; gap: 8px;">
              <button
                mat-icon-button
                class="icon-button-24"
                color="primary"
                (click)="onTimingClick(); $event.stopPropagation()"
                [matTooltip]="hasStudents() ? ('timing.view_times' | translate) : ('no_user_reserved' | translate)">
                <mat-icon class="small-16">schedule</mat-icon>
              </button>
              <img (click)="openTransferModal()"
                   *ngIf="getSubgroupForDate(courseFormGroup.controls['course_dates'].value[selectDate])?.booking_users?.length"
                   src="assets/icons/icon/exc.png"
                   class="icon24"
                   style="cursor: pointer;">
            </div>
          </div>
        </td>
        <td *ngFor="let entry of getDatesForSubgroup(); index as i"
          class="student-count-cell"
          [style.backgroundColor]="selectDate===entry.index?'var(--is-light-theme, #ffffff) var(--is-dark-theme, black)':' var(--is-light-theme, #f8f9fb) var(--is-dark-theme, #8e97a7)'"
          (click)="onSelectDate(entry.index, entry.date)"
          style="text-align: center; font-size: 11px; font-weight: 600; color: var(--color-dark1);">
          {{getStudentCount(entry.date)}}
        </td>
      </tr>
      <tr *ngFor="let user of booking_users || []; index as i">
        <ng-container *ngIf="user.degree_id === level.id">
          <td class="monitor-column-cell"
            style="text-align-last: start;background-color: var(--is-light-theme, #ffffff) var(--is-dark-theme, black);">
            <div class="flexicon" style="font-size: 11px; font-weight: 600;">
              {{user.client?.first_name}} {{user.client?.last_name}}
            </div>
            <span style="font-size: 11px;">
              {{getLanguage(user.client.language1_id)}}
              &middot; {{getCountry(user.client.country)}} &middot;
              {{calculateAge(user.client.birth_date)}} {{'years' | translate }}
            </span>
          </td>
          <td *ngFor="let entry of getDatesForSubgroup(); index as j"
            class="attendance-cell"
            [style.backgroundColor]="selectDate===entry.index?'var(--is-light-theme, #ffffff) var(--is-dark-theme, black)':' var(--is-light-theme, #f8f9fb) var(--is-dark-theme, #8e97a7)'"
            (click)="onSelectDate(entry.index, entry.date)">
            <div style="display: flex; gap: 5px; justify-content: center;">
              <ng-container *ngIf="find(entry.date.booking_users_active,'client_id',user.client_id) as userInDate">
                <mat-icon class="icon10"
                  *ngIf="userInDate?.attended"
                  style="color: #31C044;"
                  [matTooltip]="'present_course_day' | translate">
                  circle
                </mat-icon>
                <mat-icon class="icon10"
                  *ngIf="userInDate?.group_changed && !userInDate?.attended"
                  style="color: #FFCF25;"
                  [matTooltip]="'student_changed' | translate">
                  circle
                </mat-icon>
                <mat-icon class="icon10"
                  *ngIf="Date(entry.date.date) < today && !userInDate?.attended && !userInDate?.group_changed"
                  style="color: #E70F0F;"
                  [matTooltip]="'not_presented' | translate">
                  circle
                </mat-icon>
                <mat-icon class="icon10"
                  *ngIf="!userInDate?.attended && !userInDate?.group_changed"
                  style="color: #C7D0D3;"
                  [matTooltip]="'upcoming_day' | translate">
                  circle
                </mat-icon>
              </ng-container>
              <mat-icon class="icon10"
                *ngIf="!find(entry.date.booking_users_active,'client_id',user.client_id)"
                style="color: #C7D0D3;"
                [matTooltip]="'upcoming_day' | translate">
                circle
              </mat-icon>
            </div>
          </td>
        </ng-container>
      </tr>
      <tr *ngIf="!find(booking_users,'degree_id',level.id)">
        <td class="monitor-column-cell"
          style="text-align-last: start;background-color: var(--is-light-theme, #ffffff) var(--is-dark-theme, black);">
          <div class="flexicon" style="font-size: 11px; font-weight: 600;">
            {{'no_user_reserved' | translate}}
          </div>
        </td>
        <td *ngFor="let entry of getDatesForSubgroup(); index as i"
          class="attendance-cell"
          [style.backgroundColor]="selectDate===entry.index?'var(--is-light-theme, #ffffff) var(--is-dark-theme, black)':' var(--is-light-theme, #f8f9fb) var(--is-dark-theme, #8e97a7)'"
          (click)="onSelectDate(entry.index, entry.date)">
        </td>
      </tr>
    </tbody>
  </table>
</div>
<vex-flux-modal *ngIf="cambiarModal" (Close)="cambiarModal=false" title="Cambiar nivel alumno">
	<div body style="display: flex;flex-wrap: nowrap;">
		<div style="width: 50%; display: flex;">
			<div style="display: flex;
            flex-direction: column;
            gap: 16px;">
				<div class="flexicon">
					<img src="assets/icons/icon/alumno.png" class="icon24">
					{{"students" | translate}}
				</div>
				<mat-checkbox *ngFor="let item of selectedSubgroup?.booking_users; let i = index" [checked]="selectUser.includes(item)"
					(change)="onCheckboxChange($event, item)" style="display: flex;">
					<div style="display: flex; gap: 20px;">
						<div>
							<img [src]="item.client.image" style="height: 40px;height: 40px;">
						</div>
						<div>
							<div class="flexicon" style="font-size: 12px;font-weight: 600;">
								{{item.client.first_name}} {{item.client.last_name}}
							</div>
							<span style="font-size: 12px;">
								{{getLanguage(item.client.language1_id)}}
								&middot; {{getCountry(item.client.country)}} &middot;
								{{calculateAge(item.client.birth_date)}} {{'years' | translate }}
							</span>
						</div>
					</div>
				</mat-checkbox>
				<div *ngIf="selectedSubgroup?.booking_users?.length===0" style="text-align-last: start;">
					<div class="flexicon" style="font-size: 12px;font-weight: 600;">
						{{"no_user_reserved" | translate}}
					</div>
				</div>
			</div>
		</div>
		<div style="width: 50%;">
			<div class="flexicon" style="margin-bottom: 16px;">
				<img src="assets/icons/icon/alumno.png" class="icon24">
				{{'level' | translate}}
			</div>
			<vex-course-detail-nivel [checkbox]="true" [courseFormGroup]="courseFormGroup"  [selectedSubgroup]="selectedSubgroup"
				(changeMonitor)="changeMonitor($event)"></vex-course-detail-nivel>
		</div>
	</div>
	<div footer style="display: flex;width: 100%;padding: 20px 20px 0;">
		<button (click)="cambiarModal=false"
			style="margin-top: 0px !important;height: 38px; width: 128px;margin-left: auto;" mat-button type="button">
			{{'cancel' | translate }}
		</button>
	</div>
</vex-flux-modal>
